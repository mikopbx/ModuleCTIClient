"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 11 2018
 *
 */
var moduleCTIClient = {
  $wsToggle: $('#web-service-mode-toggle'),
  $wsToggleRadio: $('#module-cti-client-form .web-service-radio'),
  $statusToggle: $('#module-status-toggle'),
  $callerIdSetupToggle: $('#setup-caller-id-toggle'),
  $callerIdTransliterationToggle: $('#transliterate-caller-id-toggle'),
  $formObj: $('#module-cti-client-form'),
  $moduleStatus: $('#status'),
  $debugToggle: $('#debug-mode-toggle'),
  $autoSettingsToggle: $('#auto-settings-mode-toggle'),
  $onlyAutoSettingsVisible: $('#module-cti-client-form .only-auto-settings'),
  $onlyManualSettingsVisible: $('#module-cti-client-form .only-manual-settings'),
  $wsOnlyFields: $('.ws-only'),
  $dirrtyField: $('#dirrty'),
  $debugTab: $('#module-cti-client-tabs .item[data-tab="debug"]'),
  validateRules: {
    server1chost: {
      identifier: 'server1chost',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CHostEmpty
      }]
    },
    server1cport: {
      identifier: 'server1cport',
      rules: [{
        type: 'wrongPortCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CPortRange
      }]
    },
    database: {
      identifier: 'database',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidatePubName
      }]
    }
  },
  initialize: function initialize() {
    $('#module-cti-client-form .item').tab();

    if (moduleCTIClient.$debugToggle.checkbox('is unchecked')) {
      moduleCTIClient.$debugTab.hide();
    }

    moduleCTIClient.$debugToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$debugTab.show();
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$debugTab.hide();
      }
    });
    moduleCTIClient.$callerIdSetupToggle.checkbox({
      onChange: moduleCTIClient.setCallerIdToggle
    });

    if (moduleCTIClient.$autoSettingsToggle.checkbox('is checked')) {
      moduleCTIClient.$onlyManualSettingsVisible.hide();
    } else {
      moduleCTIClient.$onlyAutoSettingsVisible.hide();
    }

    moduleCTIClient.$autoSettingsToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$onlyAutoSettingsVisible.show();
        moduleCTIClient.$onlyManualSettingsVisible.hide();
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        Form.validateRules = {};
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        moduleCTIClient.$onlyAutoSettingsVisible.hide();
        moduleCTIClient.$onlyManualSettingsVisible.show();
        Form.validateRules = moduleCTIClient.validateRules;
      }
    });

    if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
      moduleCTIClient.enableWsFields();
    }

    moduleCTIClient.$wsToggleRadio.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');

        if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
          moduleCTIClient.enableWsFields();
        } else {
          moduleCTIClient.disableWsFields();
        }
      }
    });
    moduleCTIClient.initializeForm();
    moduleCTIClient.checkStatusToggle();
    moduleCTIClient.setCallerIdToggle();
    window.addEventListener('ModuleStatusChanged', moduleCTIClient.checkStatusToggle);
  },

  /**
   * Проверка состояния модуля
   */
  checkStatusToggle: function checkStatusToggle() {
    if (moduleCTIClient.$statusToggle.checkbox('is checked')) {
      $('.disability').removeClass('disabled');
      moduleCTIClient.$moduleStatus.show();
      moduleCTIClientConnectionCheckWorker.initialize();
    } else {
      moduleCTIClient.$moduleStatus.hide();
      moduleCTIClient.$moduleStatus.hide();
      $('.disability').addClass('disabled');
      $('.message.ajax').remove();
    }
  },

  /**
   * Переключатель установки CallerID из 1С
   * Прячет или показывает статус транслитерации
   */
  setCallerIdToggle: function setCallerIdToggle() {
    if (moduleCTIClient.$callerIdSetupToggle.checkbox('is checked')) {
      moduleCTIClient.$callerIdTransliterationToggle.show();
    } else {
      moduleCTIClient.$callerIdTransliterationToggle.hide();
    }
  },

  /**
   * Включение режима работы через WS
   */
  enableWsFields: function enableWsFields() {
    moduleCTIClient.$wsOnlyFields.removeClass('disabled');
  },

  /**
   * Выключение режима работы через WS
   */
  disableWsFields: function disableWsFields() {
    moduleCTIClient.$wsOnlyFields.addClass('disabled');
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = moduleCTIClient.$formObj.form('get values');
    return result;
  },
  cbAfterSendForm: function cbAfterSendForm() {
    moduleCTIClient.initialize();
  },
  initializeForm: function initializeForm() {
    Form.$formObj = moduleCTIClient.$formObj;
    Form.url = "".concat(globalRootUrl, "module-c-t-i-client/save");
    Form.validateRules = moduleCTIClient.validateRules;
    Form.cbBeforeSendForm = moduleCTIClient.cbBeforeSendForm;
    Form.cbAfterSendForm = moduleCTIClient.cbAfterSendForm;
    Form.initialize();
  }
};

$.fn.form.settings.rules.emptyCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked') && value === '') {
    return false;
  }

  return true;
};

$.fn.form.settings.rules.wrongPortCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked')) {
    return $.fn.form.settings.rules.integer(value, '1..65535');
  }

  return true;
};

$(document).ready(function () {
  moduleCTIClient.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtY3RpLWNsaWVudC1pbmRleC5qcyJdLCJuYW1lcyI6WyJtb2R1bGVDVElDbGllbnQiLCIkd3NUb2dnbGUiLCIkIiwiJHdzVG9nZ2xlUmFkaW8iLCIkc3RhdHVzVG9nZ2xlIiwiJGNhbGxlcklkU2V0dXBUb2dnbGUiLCIkY2FsbGVySWRUcmFuc2xpdGVyYXRpb25Ub2dnbGUiLCIkZm9ybU9iaiIsIiRtb2R1bGVTdGF0dXMiLCIkZGVidWdUb2dnbGUiLCIkYXV0b1NldHRpbmdzVG9nZ2xlIiwiJG9ubHlBdXRvU2V0dGluZ3NWaXNpYmxlIiwiJG9ubHlNYW51YWxTZXR0aW5nc1Zpc2libGUiLCIkd3NPbmx5RmllbGRzIiwiJGRpcnJ0eUZpZWxkIiwiJGRlYnVnVGFiIiwidmFsaWRhdGVSdWxlcyIsInNlcnZlcjFjaG9zdCIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJtb2RfY3RpX1ZhbGlkYXRlU2VydmVyMUNIb3N0RW1wdHkiLCJzZXJ2ZXIxY3BvcnQiLCJtb2RfY3RpX1ZhbGlkYXRlU2VydmVyMUNQb3J0UmFuZ2UiLCJkYXRhYmFzZSIsIm1vZF9jdGlfVmFsaWRhdGVQdWJOYW1lIiwiaW5pdGlhbGl6ZSIsInRhYiIsImNoZWNrYm94IiwiaGlkZSIsIm9uQ2hlY2tlZCIsInNob3ciLCJvblVuY2hlY2tlZCIsIm9uQ2hhbmdlIiwic2V0Q2FsbGVySWRUb2dnbGUiLCJ2YWwiLCJNYXRoIiwicmFuZG9tIiwidHJpZ2dlciIsIkZvcm0iLCJlbmFibGVXc0ZpZWxkcyIsImRpc2FibGVXc0ZpZWxkcyIsImluaXRpYWxpemVGb3JtIiwiY2hlY2tTdGF0dXNUb2dnbGUiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlQ2xhc3MiLCJtb2R1bGVDVElDbGllbnRDb25uZWN0aW9uQ2hlY2tXb3JrZXIiLCJhZGRDbGFzcyIsInJlbW92ZSIsImNiQmVmb3JlU2VuZEZvcm0iLCJzZXR0aW5ncyIsInJlc3VsdCIsImRhdGEiLCJmb3JtIiwiY2JBZnRlclNlbmRGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImZuIiwiZW1wdHlDdXN0b21SdWxlIiwidmFsdWUiLCJ3cm9uZ1BvcnRDdXN0b21SdWxlIiwiaW50ZWdlciIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxJQUFNQSxlQUFlLEdBQUc7QUFDdkJDLEVBQUFBLFNBQVMsRUFBRUMsQ0FBQyxDQUFDLDBCQUFELENBRFc7QUFFdkJDLEVBQUFBLGNBQWMsRUFBRUQsQ0FBQyxDQUFDLDRDQUFELENBRk07QUFHdkJFLEVBQUFBLGFBQWEsRUFBRUYsQ0FBQyxDQUFDLHVCQUFELENBSE87QUFJdkJHLEVBQUFBLG9CQUFvQixFQUFFSCxDQUFDLENBQUMseUJBQUQsQ0FKQTtBQUt2QkksRUFBQUEsOEJBQThCLEVBQUVKLENBQUMsQ0FBQyxpQ0FBRCxDQUxWO0FBTXZCSyxFQUFBQSxRQUFRLEVBQUVMLENBQUMsQ0FBQyx5QkFBRCxDQU5ZO0FBT3ZCTSxFQUFBQSxhQUFhLEVBQUVOLENBQUMsQ0FBQyxTQUFELENBUE87QUFRdkJPLEVBQUFBLFlBQVksRUFBRVAsQ0FBQyxDQUFDLG9CQUFELENBUlE7QUFTdkJRLEVBQUFBLG1CQUFtQixFQUFFUixDQUFDLENBQUMsNEJBQUQsQ0FUQztBQVV2QlMsRUFBQUEsd0JBQXdCLEVBQUVULENBQUMsQ0FBQyw2Q0FBRCxDQVZKO0FBV3ZCVSxFQUFBQSwwQkFBMEIsRUFBRVYsQ0FBQyxDQUFDLCtDQUFELENBWE47QUFZdkJXLEVBQUFBLGFBQWEsRUFBRVgsQ0FBQyxDQUFDLFVBQUQsQ0FaTztBQWF2QlksRUFBQUEsWUFBWSxFQUFFWixDQUFDLENBQUMsU0FBRCxDQWJRO0FBY3ZCYSxFQUFBQSxTQUFTLEVBQUViLENBQUMsQ0FBQyxpREFBRCxDQWRXO0FBZXZCYyxFQUFBQSxhQUFhLEVBQUU7QUFDZEMsSUFBQUEsWUFBWSxF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LEVBQUYsQ0FBS0osSUFBTCxDQUFVSCxRQUFWLENBQW1CbEMsS0FBbkIsQ0FBeUI2QyxPQUF6QixDQUFpQ0YsS0FBakMsRUFBd0MsVUFBeEMsQ0FBUDtBQUNBOztBQUNELFNBQU8sSUFBUDtBQUNBLENBUEQ7O0FBU0E1RCxDQUFDLENBQUMrRCxRQUFELENBQUQsQ0FBWUMsS0FBWixDQUFrQixZQUFNO0FBQ3ZCbEUsRUFBQUEsZUFBZSxDQUFDNEIsVUFBaEI7QUFDQSxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoQykgTUlLTyBMTEMgLSBBbGwgUmlnaHRzIFJlc2VydmVkXG4gKiBVbmF1dGhvcml6ZWQgY29weWluZyBvZiB0aGlzIGZpbGUsIHZpYSBhbnkgbWVkaXVtIGlzIHN0cmljdGx5IHByb2hpYml0ZWRcbiAqIFByb3ByaWV0YXJ5IGFuZCBjb25maWRlbnRpYWxcbiAqIFdyaXR0ZW4gYnkgTmlrb2xheSBCZWtldG92LCAxMSAyMDE4XG4gKlxuICovXG5cbmNvbnN0IG1vZHVsZUNUSUNsaWVudCA9IHtcblx0JHdzVG9nZ2xlOiAkKCcjd2ViLXNlcnZpY2UtbW9kZS10b2dnbGUnKSxcblx0JHdzVG9nZ2xlUmFkaW86ICQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtIC53ZWItc2VydmljZS1yYWRpbycpLFxuXHQkc3RhdHVzVG9nZ2xlOiAkKCcjbW9kdWxlLXN0YXR1cy10b2dnbGUnKSxcblx0JGNhbGxlcklkU2V0dXBUb2dnbGU6ICQoJyNzZXR1cC1jYWxsZXItaWQtdG9nZ2xlJyksXG5cdCRjYWxsZXJJZFRyYW5zbGl0ZXJhdGlvblRvZ2dsZTogJCgnI3RyYW5zbGl0ZXJhdGUtY2FsbGVyLWlkLXRvZ2dsZScpLFxuXHQkZm9ybU9iajogJCgnI21vZHVsZS1jdGktY2xpZW50LWZvcm0nKSxcblx0JG1vZHVsZVN0YXR1czogJCgnI3N0YXR1cycpLFxuXHQkZGVidWdUb2dnbGU6ICQoJyNkZWJ1Zy1tb2RlLXRvZ2dsZScpLFxuXHQkYXV0b1NldHRpbmdzVG9nZ2xlOiAkKCcjYXV0by1zZXR0aW5ncy1tb2RlLXRvZ2dsZScpLFxuXHQkb25seUF1dG9TZXR0aW5nc1Zpc2libGU6ICQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtIC5vbmx5LWF1dG8tc2V0dGluZ3MnKSxcblx0JG9ubHlNYW51YWxTZXR0aW5nc1Zpc2libGU6ICQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtIC5vbmx5LW1hbnVhbC1zZXR0aW5ncycpLFxuXHQkd3NPbmx5RmllbGRzOiAkKCcud3Mtb25seScpLFxuXHQkZGlycnR5RmllbGQ6ICQoJyNkaXJydHknKSxcblx0JGRlYnVnVGFiOiAkKCcjbW9kdWxlLWN0aS1jbGllbnQtdGFicyAuaXRlbVtkYXRhLXRhYj1cImRlYnVnXCJdJyksXG5cdHZhbGlkYXRlUnVsZXM6IHtcblx0XHRzZXJ2ZXIxY2hvc3Q6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdzZXJ2ZXIxY2hvc3QnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eUN1c3RvbVJ1bGUnLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLm1vZF9jdGlfVmFsaWRhdGVTZXJ2ZXIxQ0hvc3RFbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRzZXJ2ZXIxY3BvcnQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdzZXJ2ZXIxY3BvcnQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICd3cm9uZ1BvcnRDdXN0b21SdWxlJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5tb2RfY3RpX1ZhbGlkYXRlU2VydmVyMUNQb3J0UmFuZ2UsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0ZGF0YWJhc2U6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdkYXRhYmFzZScsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Q3VzdG9tUnVsZScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUubW9kX2N0aV9WYWxpZGF0ZVB1Yk5hbWUsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0JCgnI21vZHVsZS1jdGktY2xpZW50LWZvcm0gLml0ZW0nKS50YWIoKTtcblx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiRkZWJ1Z1RvZ2dsZS5jaGVja2JveCgnaXMgdW5jaGVja2VkJykpe1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkZWJ1Z1RhYi5oaWRlKClcblx0XHR9XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LiRkZWJ1Z1RvZ2dsZVxuXHRcdFx0LmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGVja2VkKCkge1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGVidWdUYWIuc2hvdygpXG5cdFx0XHRcdH0sXG5cdFx0XHRcdG9uVW5jaGVja2VkKCkge1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGVidWdUYWIuaGlkZSgpXG5cdFx0XHRcdH0sXG5cdFx0XHR9KTtcblxuXG5cdFx0bW9kdWxlQ1RJQ2xpZW50LiRjYWxsZXJJZFNldHVwVG9nZ2xlXG5cdFx0XHQuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoYW5nZTogbW9kdWxlQ1RJQ2xpZW50LnNldENhbGxlcklkVG9nZ2xlXG5cdFx0XHR9KTtcblxuXG5cdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kYXV0b1NldHRpbmdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpe1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlLmhpZGUoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5QXV0b1NldHRpbmdzVmlzaWJsZS5oaWRlKCk7XG5cdFx0fVxuXHRcdG1vZHVsZUNUSUNsaWVudC4kYXV0b1NldHRpbmdzVG9nZ2xlXG5cdFx0XHQuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5QXV0b1NldHRpbmdzVmlzaWJsZS5zaG93KCk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlLmhpZGUoKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IHt9O1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRvblVuY2hlY2tlZCgpIHtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seUF1dG9TZXR0aW5nc1Zpc2libGUuaGlkZSgpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seU1hbnVhbFNldHRpbmdzVmlzaWJsZS5zaG93KCk7XG5cdFx0XHRcdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0gbW9kdWxlQ1RJQ2xpZW50LnZhbGlkYXRlUnVsZXM7XG5cdFx0XHRcdH0sXG5cdFx0XHR9KTtcblxuXG5cdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSkge1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LmVuYWJsZVdzRmllbGRzKCk7XG5cdFx0fVxuXHRcdG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGVSYWRpb1xuXHRcdFx0LmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGVja2VkKCkge1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSkge1xuXHRcdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LmVuYWJsZVdzRmllbGRzKCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC5kaXNhYmxlV3NGaWVsZHMoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sXG5cdFx0XHR9KTtcblx0XHRtb2R1bGVDVElDbGllbnQuaW5pdGlhbGl6ZUZvcm0oKTtcblx0XHRtb2R1bGVDVElDbGllbnQuY2hlY2tTdGF0dXNUb2dnbGUoKTtcblx0XHRtb2R1bGVDVElDbGllbnQuc2V0Q2FsbGVySWRUb2dnbGUoKTtcblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignTW9kdWxlU3RhdHVzQ2hhbmdlZCcsIG1vZHVsZUNUSUNsaWVudC5jaGVja1N0YXR1c1RvZ2dsZSk7XG5cdH0sXG5cdC8qKlxuXHQgKiDQn9GA0L7QstC10YDQutCwINGB0L7RgdGC0L7Rj9C90LjRjyDQvNC+0LTRg9C70Y9cblx0ICovXG5cdGNoZWNrU3RhdHVzVG9nZ2xlKCkge1xuXHRcdGlmIChtb2R1bGVDVElDbGllbnQuJHN0YXR1c1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKSB7XG5cdFx0XHQkKCcuZGlzYWJpbGl0eScpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRtb2R1bGVTdGF0dXMuc2hvdygpO1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50Q29ubmVjdGlvbkNoZWNrV29ya2VyLmluaXRpYWxpemUoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRtb2R1bGVTdGF0dXMuaGlkZSgpO1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRtb2R1bGVTdGF0dXMuaGlkZSgpO1xuXHRcdFx0JCgnLmRpc2FiaWxpdHknKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdCQoJy5tZXNzYWdlLmFqYXgnKS5yZW1vdmUoKTtcblx0XHR9XG5cdH0sXG5cdC8qKlxuXHQgKiDQn9C10YDQtdC60LvRjtGH0LDRgtC10LvRjCDRg9GB0YLQsNC90L7QstC60LggQ2FsbGVySUQg0LjQtyAx0KFcblx0ICog0J/RgNGP0YfQtdGCINC40LvQuCDQv9C+0LrQsNC30YvQstCw0LXRgiDRgdGC0LDRgtGD0YEg0YLRgNCw0L3RgdC70LjRgtC10YDQsNGG0LjQuFxuXHQgKi9cblx0c2V0Q2FsbGVySWRUb2dnbGUoKSB7XG5cdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kY2FsbGVySWRTZXR1cFRvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKSB7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJGNhbGxlcklkVHJhbnNsaXRlcmF0aW9uVG9nZ2xlLnNob3coKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRjYWxsZXJJZFRyYW5zbGl0ZXJhdGlvblRvZ2dsZS5oaWRlKCk7XG5cdFx0fVxuXHR9LFxuXHQvKipcblx0ICog0JLQutC70Y7Rh9C10L3QuNC1INGA0LXQttC40LzQsCDRgNCw0LHQvtGC0Ysg0YfQtdGA0LXQtyBXU1xuXHQgKi9cblx0ZW5hYmxlV3NGaWVsZHMoKSB7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LiR3c09ubHlGaWVsZHMucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdH0sXG5cdC8qKlxuXHQgKiDQktGL0LrQu9GO0YfQtdC90LjQtSDRgNC10LbQuNC80LAg0YDQsNCx0L7RgtGLINGH0LXRgNC10LcgV1Ncblx0ICovXG5cdGRpc2FibGVXc0ZpZWxkcygpIHtcblx0XHRtb2R1bGVDVElDbGllbnQuJHdzT25seUZpZWxkcy5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0fSxcblx0Y2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncykge1xuXHRcdGNvbnN0IHJlc3VsdCA9IHNldHRpbmdzO1xuXHRcdHJlc3VsdC5kYXRhID0gbW9kdWxlQ1RJQ2xpZW50LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHRjYkFmdGVyU2VuZEZvcm0oKSB7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LmluaXRpYWxpemUoKTtcblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IG1vZHVsZUNUSUNsaWVudC4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLWMtdC1pLWNsaWVudC9zYXZlYDtcblx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBtb2R1bGVDVElDbGllbnQudmFsaWRhdGVSdWxlcztcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBtb2R1bGVDVElDbGllbnQuY2JCZWZvcmVTZW5kRm9ybTtcblx0XHRGb3JtLmNiQWZ0ZXJTZW5kRm9ybSA9IG1vZHVsZUNUSUNsaWVudC5jYkFmdGVyU2VuZEZvcm07XG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5lbXB0eUN1c3RvbVJ1bGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0aWYgKG1vZHVsZUNUSUNsaWVudC4kYXV0b1NldHRpbmdzVG9nZ2xlLmNoZWNrYm94KCdpcyB1bmNoZWNrZWQnKVxuXHRcdCYmIG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKVxuXHRcdCYmIHZhbHVlID09PSAnJykge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy53cm9uZ1BvcnRDdXN0b21SdWxlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdGlmIChtb2R1bGVDVElDbGllbnQuJGF1dG9TZXR0aW5nc1RvZ2dsZS5jaGVja2JveCgnaXMgdW5jaGVja2VkJylcblx0XHQmJiBtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJylcblx0KSB7XG5cdFx0cmV0dXJuICQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5pbnRlZ2VyKHZhbHVlLCAnMS4uNjU1MzUnKTtcblx0fVxuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0bW9kdWxlQ1RJQ2xpZW50LmluaXRpYWxpemUoKTtcbn0pO1xuXG4iXX0=