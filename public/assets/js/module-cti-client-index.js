"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 11 2018
 *
 */
var moduleCTIClient = {
  $wsToggle: $('#web-service-mode-toggle'),
  $wsToggleRadio: $('#module-cti-client-form .web-service-radio'),
  $statusToggle: $('#module-status-toggle'),
  $callerIdSetupToggle: $('#setup-caller-id-toggle'),
  $callerIdTransliterationToggleBlock: $('#transliterate-caller-id-toggle-block'),
  $formObj: $('#module-cti-client-form'),
  $moduleStatus: $('#status'),
  $debugToggle: $('#debug-mode-toggle'),
  $autoSettingsToggle: $('#auto-settings-mode-toggle'),
  $onlyAutoSettingsVisible: $('#module-cti-client-form .only-auto-settings'),
  $onlyManualSettingsVisible: $('#module-cti-client-form .only-manual-settings'),
  $wsOnlyFields: $('.ws-only'),
  $dirrtyField: $('#dirrty'),
  $debugTab: $('#module-cti-client-tabs .item[data-tab="debug"]'),
  validateRules: {
    server1chost: {
      identifier: 'server1chost',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CHostEmpty
      }]
    },
    server1cport: {
      identifier: 'server1cport',
      rules: [{
        type: 'wrongPortCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CPortRange
      }]
    },
    database: {
      identifier: 'database',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidatePubName
      }]
    }
  },
  initialize: function initialize() {
    $('#module-cti-client-form .item').tab();

    if (moduleCTIClient.$debugToggle.checkbox('is unchecked')) {
      moduleCTIClient.$debugTab.hide();
    }

    moduleCTIClient.$debugToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$debugTab.show();
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$debugTab.hide();
      }
    });
    moduleCTIClient.$callerIdSetupToggle.checkbox({
      onChange: moduleCTIClient.setCallerIdToggle
    });

    if (moduleCTIClient.$autoSettingsToggle.checkbox('is checked')) {
      moduleCTIClient.$onlyManualSettingsVisible.hide();
    } else {
      moduleCTIClient.$onlyAutoSettingsVisible.hide();
    }

    moduleCTIClient.$autoSettingsToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$onlyAutoSettingsVisible.show();
        moduleCTIClient.$onlyManualSettingsVisible.hide();
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        Form.validateRules = {};
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        moduleCTIClient.$onlyAutoSettingsVisible.hide();
        moduleCTIClient.$onlyManualSettingsVisible.show();
        Form.validateRules = moduleCTIClient.validateRules;
      }
    });

    if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
      moduleCTIClient.enableWsFields();
    }

    moduleCTIClient.$wsToggleRadio.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');

        if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
          moduleCTIClient.enableWsFields();
        } else {
          moduleCTIClient.disableWsFields();
        }
      }
    });
    moduleCTIClient.initializeForm();
    moduleCTIClient.checkStatusToggle();
    moduleCTIClient.setCallerIdToggle();
    window.addEventListener('ModuleStatusChanged', moduleCTIClient.checkStatusToggle);
  },

  /**
   * Проверка состояния модуля
   */
  checkStatusToggle: function checkStatusToggle() {
    if (moduleCTIClient.$statusToggle.checkbox('is checked')) {
      $('.disability').removeClass('disabled');
      moduleCTIClient.$moduleStatus.show();
      moduleCTIClientConnectionCheckWorker.initialize();
    } else {
      moduleCTIClient.$moduleStatus.hide();
      moduleCTIClient.$moduleStatus.hide();
      $('.disability').addClass('disabled');
      $('.message.ajax').remove();
    }
  },

  /**
   * Переключатель установки CallerID из 1С
   * Прячет или показывает статус транслитерации
   */
  setCallerIdToggle: function setCallerIdToggle() {
    if (moduleCTIClient.$callerIdSetupToggle.checkbox('is checked')) {
      moduleCTIClient.$callerIdTransliterationToggleBlock.show();
    } else {
      moduleCTIClient.$callerIdTransliterationToggleBlock.hide();
    }
  },

  /**
   * Включение режима работы через WS
   */
  enableWsFields: function enableWsFields() {
    moduleCTIClient.$wsOnlyFields.removeClass('disabled');
  },

  /**
   * Выключение режима работы через WS
   */
  disableWsFields: function disableWsFields() {
    moduleCTIClient.$wsOnlyFields.addClass('disabled');
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = moduleCTIClient.$formObj.form('get values');
    return result;
  },
  cbAfterSendForm: function cbAfterSendForm() {
    moduleCTIClient.initialize();
  },
  initializeForm: function initializeForm() {
    Form.$formObj = moduleCTIClient.$formObj;
    Form.url = "".concat(globalRootUrl, "module-c-t-i-client/save");
    Form.validateRules = moduleCTIClient.validateRules;
    Form.cbBeforeSendForm = moduleCTIClient.cbBeforeSendForm;
    Form.cbAfterSendForm = moduleCTIClient.cbAfterSendForm;
    Form.initialize();
  }
};

$.fn.form.settings.rules.emptyCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked') && value === '') {
    return false;
  }

  return true;
};

$.fn.form.settings.rules.wrongPortCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked')) {
    return $.fn.form.settings.rules.integer(value, '1..65535');
  }

  return true;
};

$(document).ready(function () {
  moduleCTIClient.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtY3RpLWNsaWVudC1pbmRleC5qcyJdLCJuYW1lcyI6WyJtb2R1bGVDVElDbGllbnQiLCIkd3NUb2dnbGUiLCIkIiwiJHdzVG9nZ2xlUmFkaW8iLCIkc3RhdHVzVG9nZ2xlIiwiJGNhbGxlcklkU2V0dXBUb2dnbGUiLCIkY2FsbGVySWRUcmFuc2xpdGVyYXRpb25Ub2dnbGVCbG9jayIsIiRmb3JtT2JqIiwiJG1vZHVsZVN0YXR1cyIsIiRkZWJ1Z1RvZ2dsZSIsIiRhdXRvU2V0dGluZ3NUb2dnbGUiLCIkb25seUF1dG9TZXR0aW5nc1Zpc2libGUiLCIkb25seU1hbnVhbFNldHRpbmdzVmlzaWJsZSIsIiR3c09ubHlGaWVsZHMiLCIkZGlycnR5RmllbGQiLCIkZGVidWdUYWIiLCJ2YWxpZGF0ZVJ1bGVzIiwic2VydmVyMWNob3N0IiwiaWRlbnRpZmllciIsInJ1bGVzIiwidHlwZSIsInByb21wdCIsImdsb2JhbFRyYW5zbGF0ZSIsIm1vZF9jdGlfVmFsaWRhdGVTZXJ2ZXIxQ0hvc3RFbXB0eSIsInNlcnZlcjFjcG9ydCIsIm1vZF9jdGlfVmFsaWRhdGVTZXJ2ZXIxQ1BvcnRSYW5nZSIsImRhdGFiYXNlIiwibW9kX2N0aV9WYWxpZGF0ZVB1Yk5hbWUiLCJpbml0aWFsaXplIiwidGFiIiwiY2hlY2tib3giLCJoaWRlIiwib25DaGVja2VkIiwic2hvdyIsIm9uVW5jaGVja2VkIiwib25DaGFuZ2UiLCJzZXRDYWxsZXJJZFRvZ2dsZSIsInZhbCIsIk1hdGgiLCJyYW5kb20iLCJ0cmlnZ2VyIiwiRm9ybSIsImVuYWJsZVdzRmllbGRzIiwiZGlzYWJsZVdzRmllbGRzIiwiaW5pdGlhbGl6ZUZvcm0iLCJjaGVja1N0YXR1c1RvZ2dsZSIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVDbGFzcyIsIm1vZHVsZUNUSUNsaWVudENvbm5lY3Rpb25DaGVja1dvcmtlciIsImFkZENsYXNzIiwicmVtb3ZlIiwiY2JCZWZvcmVTZW5kRm9ybSIsInNldHRpbmdzIiwicmVzdWx0IiwiZGF0YSIsImZvcm0iLCJjYkFmdGVyU2VuZEZvcm0iLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwiZm4iLCJlbXB0eUN1c3RvbVJ1bGUiLCJ2YWx1ZSIsIndyb25nUG9ydEN1c3RvbVJ1bGUiLCJpbnRlZ2VyIiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLElBQU1BLGVBQWUsR0FBRztBQUN2QkMsRUFBQUEsU0FBUyxFQUFFQyxDQUFDLENBQUMsMEJBQUQsQ0FEVztBQUV2QkMsRUFBQUEsY0FBYyxFQUFFRCxDQUFDLENBQUMsNENBQUQsQ0FGTTtBQUd2QkUsRUFBQUEsYUFBYSxFQUFFRixDQUFDLENBQUMsdUJBQUQsQ0FITztBQUl2QkcsRUFBQUEsb0JBQW9CLEVBQUVILENBQUMsQ0FBQyx5QkFBRCxDQUpBO0FBS3ZCSSxFQUFBQSxtQ0FBbUMsRUFBRUosQ0FBQyxDQUFDLHVDQUFELENBTGY7QUFNdkJLLEVBQUFBLFFBQVEsRUFBRUwsQ0FBQyxDQUFDLHlCQUFELENBTlk7QUFPdkJNLEVBQUFBLGFBQWEsRUFBRU4sQ0FBQyxDQUFDLFNBQUQsQ0FQTztBQVF2Qk8sRUFBQUEsWUFBWSxFQUFFUCxDQUFDLENBQUMsb0JBQUQsQ0FSUTtBQVN2QlEsRUFBQUEsbUJBQW1CLEVBQUVSLENBQUMsQ0FBQyw0QkFBRCxDQVRDO0FBVXZCUyxFQUFBQSx3QkFBd0IsRUFBRVQsQ0FBQyxDQUFDLDZDQUFELENBVko7QUFXdkJVLEVBQUFBLDBCQUEwQixFQUFFVixDQUFDLENBQUMsK0NBQUQsQ0FYTjtBQVl2QlcsRUFBQUEsYUFBYSxFQUFFWCxDQUFDLENBQUMsVUFBRCxDQVpPO0FBYXZCWSxFQUFBQSxZQUFZLEVBQUVaLENBQUMsQ0FBQyxTQUFELENBYlE7QUFjdkJhLEVBQUFBLFNBQVMsRUFBRWIsQ0FBQyxDQUFDLGlEQUFELENBZFc7QUFldkJjLEVBQUFBLGFBQWEsRUFBRTtBQUNkQyxJQUFBQSxZ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QUFDMEQsRUFBRixDQUFLSixJQUFMLENBQVVILFFBQVYsQ0FBbUJsQyxLQUFuQixDQUF5QjZDLE9BQXpCLENBQWlDRixLQUFqQyxFQUF3QyxVQUF4QyxDQUFQO0FBQ0E7O0FBQ0QsU0FBTyxJQUFQO0FBQ0EsQ0FQRDs7QUFTQTVELENBQUMsQ0FBQytELFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkJsRSxFQUFBQSxlQUFlLENBQUM0QixVQUFoQjtBQUNBLENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IChDKSBNSUtPIExMQyAtIEFsbCBSaWdodHMgUmVzZXJ2ZWRcbiAqIFVuYXV0aG9yaXplZCBjb3B5aW5nIG9mIHRoaXMgZmlsZSwgdmlhIGFueSBtZWRpdW0gaXMgc3RyaWN0bHkgcHJvaGliaXRlZFxuICogUHJvcHJpZXRhcnkgYW5kIGNvbmZpZGVudGlhbFxuICogV3JpdHRlbiBieSBOaWtvbGF5IEJla2V0b3YsIDExIDIwMThcbiAqXG4gKi9cblxuY29uc3QgbW9kdWxlQ1RJQ2xpZW50ID0ge1xuXHQkd3NUb2dnbGU6ICQoJyN3ZWItc2VydmljZS1tb2RlLXRvZ2dsZScpLFxuXHQkd3NUb2dnbGVSYWRpbzogJCgnI21vZHVsZS1jdGktY2xpZW50LWZvcm0gLndlYi1zZXJ2aWNlLXJhZGlvJyksXG5cdCRzdGF0dXNUb2dnbGU6ICQoJyNtb2R1bGUtc3RhdHVzLXRvZ2dsZScpLFxuXHQkY2FsbGVySWRTZXR1cFRvZ2dsZTogJCgnI3NldHVwLWNhbGxlci1pZC10b2dnbGUnKSxcblx0JGNhbGxlcklkVHJhbnNsaXRlcmF0aW9uVG9nZ2xlQmxvY2s6ICQoJyN0cmFuc2xpdGVyYXRlLWNhbGxlci1pZC10b2dnbGUtYmxvY2snKSxcblx0JGZvcm1PYmo6ICQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtJyksXG5cdCRtb2R1bGVTdGF0dXM6ICQoJyNzdGF0dXMnKSxcblx0JGRlYnVnVG9nZ2xlOiAkKCcjZGVidWctbW9kZS10b2dnbGUnKSxcblx0JGF1dG9TZXR0aW5nc1RvZ2dsZTogJCgnI2F1dG8tc2V0dGluZ3MtbW9kZS10b2dnbGUnKSxcblx0JG9ubHlBdXRvU2V0dGluZ3NWaXNpYmxlOiAkKCcjbW9kdWxlLWN0aS1jbGllbnQtZm9ybSAub25seS1hdXRvLXNldHRpbmdzJyksXG5cdCRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlOiAkKCcjbW9kdWxlLWN0aS1jbGllbnQtZm9ybSAub25seS1tYW51YWwtc2V0dGluZ3MnKSxcblx0JHdzT25seUZpZWxkczogJCgnLndzLW9ubHknKSxcblx0JGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cdCRkZWJ1Z1RhYjogJCgnI21vZHVsZS1jdGktY2xpZW50LXRhYnMgLml0ZW1bZGF0YS10YWI9XCJkZWJ1Z1wiXScpLFxuXHR2YWxpZGF0ZVJ1bGVzOiB7XG5cdFx0c2VydmVyMWNob3N0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnc2VydmVyMWNob3N0Jyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHlDdXN0b21SdWxlJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5tb2RfY3RpX1ZhbGlkYXRlU2VydmVyMUNIb3N0RW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0c2VydmVyMWNwb3J0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnc2VydmVyMWNwb3J0Jyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnd3JvbmdQb3J0Q3VzdG9tUnVsZScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUubW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDUG9ydFJhbmdlLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdGRhdGFiYXNlOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnZGF0YWJhc2UnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eUN1c3RvbVJ1bGUnLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLm1vZF9jdGlfVmFsaWRhdGVQdWJOYW1lLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHR9LFxuXHRpbml0aWFsaXplKCkge1xuXHRcdCQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtIC5pdGVtJykudGFiKCk7XG5cdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kZGVidWdUb2dnbGUuY2hlY2tib3goJ2lzIHVuY2hlY2tlZCcpKXtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGVidWdUYWIuaGlkZSgpXG5cdFx0fVxuXHRcdG1vZHVsZUNUSUNsaWVudC4kZGVidWdUb2dnbGVcblx0XHRcdC5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hlY2tlZCgpIHtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRlYnVnVGFiLnNob3coKVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRvblVuY2hlY2tlZCgpIHtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRlYnVnVGFiLmhpZGUoKVxuXHRcdFx0XHR9LFxuXHRcdFx0fSk7XG5cblxuXHRcdG1vZHVsZUNUSUNsaWVudC4kY2FsbGVySWRTZXR1cFRvZ2dsZVxuXHRcdFx0LmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGFuZ2U6IG1vZHVsZUNUSUNsaWVudC5zZXRDYWxsZXJJZFRvZ2dsZVxuXHRcdFx0fSk7XG5cblxuXHRcdGlmIChtb2R1bGVDVElDbGllbnQuJGF1dG9TZXR0aW5nc1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKXtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seU1hbnVhbFNldHRpbmdzVmlzaWJsZS5oaWRlKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seUF1dG9TZXR0aW5nc1Zpc2libGUuaGlkZSgpO1xuXHRcdH1cblx0XHRtb2R1bGVDVElDbGllbnQuJGF1dG9TZXR0aW5nc1RvZ2dsZVxuXHRcdFx0LmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGVja2VkKCkge1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seUF1dG9TZXR0aW5nc1Zpc2libGUuc2hvdygpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seU1hbnVhbFNldHRpbmdzVmlzaWJsZS5oaWRlKCk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSB7fTtcblx0XHRcdFx0fSxcblx0XHRcdFx0b25VbmNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlBdXRvU2V0dGluZ3NWaXNpYmxlLmhpZGUoKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlNYW51YWxTZXR0aW5nc1Zpc2libGUuc2hvdygpO1xuXHRcdFx0XHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IG1vZHVsZUNUSUNsaWVudC52YWxpZGF0ZVJ1bGVzO1xuXHRcdFx0XHR9LFxuXHRcdFx0fSk7XG5cblxuXHRcdGlmIChtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC5lbmFibGVXc0ZpZWxkcygpO1xuXHRcdH1cblx0XHRtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlUmFkaW9cblx0XHRcdC5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hlY2tlZCgpIHtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHRcdGlmIChtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcblx0XHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC5lbmFibGVXc0ZpZWxkcygpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuZGlzYWJsZVdzRmllbGRzKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXHRcdFx0fSk7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LmluaXRpYWxpemVGb3JtKCk7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LmNoZWNrU3RhdHVzVG9nZ2xlKCk7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LnNldENhbGxlcklkVG9nZ2xlKCk7XG5cdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ01vZHVsZVN0YXR1c0NoYW5nZWQnLCBtb2R1bGVDVElDbGllbnQuY2hlY2tTdGF0dXNUb2dnbGUpO1xuXHR9LFxuXHQvKipcblx0ICog0J/RgNC+0LLQtdGA0LrQsCDRgdC+0YHRgtC+0Y/QvdC40Y8g0LzQvtC00YPQu9GPXG5cdCAqL1xuXHRjaGVja1N0YXR1c1RvZ2dsZSgpIHtcblx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiRzdGF0dXNUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSkge1xuXHRcdFx0JCgnLmRpc2FiaWxpdHknKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kbW9kdWxlU3RhdHVzLnNob3coKTtcblx0XHRcdG1vZHVsZUNUSUNsaWVudENvbm5lY3Rpb25DaGVja1dvcmtlci5pbml0aWFsaXplKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kbW9kdWxlU3RhdHVzLmhpZGUoKTtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kbW9kdWxlU3RhdHVzLmhpZGUoKTtcblx0XHRcdCQoJy5kaXNhYmlsaXR5JykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHQkKCcubWVzc2FnZS5hamF4JykucmVtb3ZlKCk7XG5cdFx0fVxuXHR9LFxuXHQvKipcblx0ICog0J/QtdGA0LXQutC70Y7Rh9Cw0YLQtdC70Ywg0YPRgdGC0LDQvdC+0LLQutC4IENhbGxlcklEINC40LcgMdChXG5cdCAqINCf0YDRj9GH0LXRgiDQuNC70Lgg0L/QvtC60LDQt9GL0LLQsNC10YIg0YHRgtCw0YLRg9GBINGC0YDQsNC90YHQu9C40YLQtdGA0LDRhtC40Lhcblx0ICovXG5cdHNldENhbGxlcklkVG9nZ2xlKCkge1xuXHRcdGlmIChtb2R1bGVDVElDbGllbnQuJGNhbGxlcklkU2V0dXBUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSkge1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRjYWxsZXJJZFRyYW5zbGl0ZXJhdGlvblRvZ2dsZUJsb2NrLnNob3coKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRjYWxsZXJJZFRyYW5zbGl0ZXJhdGlvblRvZ2dsZUJsb2NrLmhpZGUoKTtcblx0XHR9XG5cdH0sXG5cdC8qKlxuXHQgKiDQktC60LvRjtGH0LXQvdC40LUg0YDQtdC20LjQvNCwINGA0LDQsdC+0YLRiyDRh9C10YDQtdC3IFdTXG5cdCAqL1xuXHRlbmFibGVXc0ZpZWxkcygpIHtcblx0XHRtb2R1bGVDVElDbGllbnQuJHdzT25seUZpZWxkcy5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0fSxcblx0LyoqXG5cdCAqINCS0YvQutC70Y7Rh9C10L3QuNC1INGA0LXQttC40LzQsCDRgNCw0LHQvtGC0Ysg0YfQtdGA0LXQtyBXU1xuXHQgKi9cblx0ZGlzYWJsZVdzRmllbGRzKCkge1xuXHRcdG1vZHVsZUNUSUNsaWVudC4kd3NPbmx5RmllbGRzLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHR9LFxuXHRjYkJlZm9yZVNlbmRGb3JtKHNldHRpbmdzKSB7XG5cdFx0Y29uc3QgcmVzdWx0ID0gc2V0dGluZ3M7XG5cdFx0cmVzdWx0LmRhdGEgPSBtb2R1bGVDVElDbGllbnQuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdGNiQWZ0ZXJTZW5kRm9ybSgpIHtcblx0XHRtb2R1bGVDVElDbGllbnQuaW5pdGlhbGl6ZSgpO1xuXHR9LFxuXHRpbml0aWFsaXplRm9ybSgpIHtcblx0XHRGb3JtLiRmb3JtT2JqID0gbW9kdWxlQ1RJQ2xpZW50LiRmb3JtT2JqO1xuXHRcdEZvcm0udXJsID0gYCR7Z2xvYmFsUm9vdFVybH1tb2R1bGUtYy10LWktY2xpZW50L3NhdmVgO1xuXHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IG1vZHVsZUNUSUNsaWVudC52YWxpZGF0ZVJ1bGVzO1xuXHRcdEZvcm0uY2JCZWZvcmVTZW5kRm9ybSA9IG1vZHVsZUNUSUNsaWVudC5jYkJlZm9yZVNlbmRGb3JtO1xuXHRcdEZvcm0uY2JBZnRlclNlbmRGb3JtID0gbW9kdWxlQ1RJQ2xpZW50LmNiQWZ0ZXJTZW5kRm9ybTtcblx0XHRGb3JtLmluaXRpYWxpemUoKTtcblx0fSxcbn07XG5cblxuJC5mbi5mb3JtLnNldHRpbmdzLnJ1bGVzLmVtcHR5Q3VzdG9tUnVsZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRpZiAobW9kdWxlQ1RJQ2xpZW50LiRhdXRvU2V0dGluZ3NUb2dnbGUuY2hlY2tib3goJ2lzIHVuY2hlY2tlZCcpXG5cdFx0JiYgbW9kdWxlQ1RJQ2xpZW50LiR3c1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpXG5cdFx0JiYgdmFsdWUgPT09ICcnKSB7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cdHJldHVybiB0cnVlO1xufTtcblxuJC5mbi5mb3JtLnNldHRpbmdzLnJ1bGVzLndyb25nUG9ydEN1c3RvbVJ1bGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0aWYgKG1vZHVsZUNUSUNsaWVudC4kYXV0b1NldHRpbmdzVG9nZ2xlLmNoZWNrYm94KCdpcyB1bmNoZWNrZWQnKVxuXHRcdCYmIG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKVxuXHQpIHtcblx0XHRyZXR1cm4gJC5mbi5mb3JtLnNldHRpbmdzLnJ1bGVzLmludGVnZXIodmFsdWUsICcxLi42NTUzNScpO1xuXHR9XG5cdHJldHVybiB0cnVlO1xufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRtb2R1bGVDVElDbGllbnQuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==