"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 11 2018
 *
 */
var moduleCTIClient = {
  $wsToggle: $('#web-service-mode-toggle'),
  $wsToggleRadio: $('#module-cti-client-form .web-service-radio'),
  $statusToggle: $('#module-status-toggle'),
  $formObj: $('#module-cti-client-form'),
  $moduleStatus: $('#status'),
  $debugToggle: $('#debug-mode-toggle'),
  $autoSettingsToggle: $('#auto-settings-mode-toggle'),
  $onlyAutoSettingsVisible: $('#module-cti-client-form .only-auto-settings'),
  $onlyManualSettingsVisible: $('#module-cti-client-form .only-manual-settings'),
  $wsOnlyFields: $('.ws-only'),
  $dirrtyField: $('#dirrty'),
  $debugTab: $('#module-cti-client-tabs .item[data-tab="debug"]'),
  validateRules: {
    server1chost: {
      identifier: 'server1chost',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CHostEmpty
      }]
    },
    server1cport: {
      identifier: 'server1cport',
      rules: [{
        type: 'wrongPortCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CPortRange
      }]
    },
    database: {
      identifier: 'database',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidatePubName
      }]
    }
  },
  initialize: function initialize() {
    $('#module-cti-client-form .item').tab();

    if (moduleCTIClient.$debugToggle.checkbox('is unchecked')) {
      moduleCTIClient.$debugTab.hide();
    }

    moduleCTIClient.$debugToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$debugTab.show();
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$debugTab.hide();
      }
    });

    if (moduleCTIClient.$autoSettingsToggle.checkbox('is checked')) {
      moduleCTIClient.$onlyManualSettingsVisible.hide();
    } else {
      moduleCTIClient.$onlyAutoSettingsVisible.hide();
    }

    moduleCTIClient.$autoSettingsToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$onlyAutoSettingsVisible.show();
        moduleCTIClient.$onlyManualSettingsVisible.hide();
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        Form.validateRules = {};
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        moduleCTIClient.$onlyAutoSettingsVisible.hide();
        moduleCTIClient.$onlyManualSettingsVisible.show();
        Form.validateRules = moduleCTIClient.validateRules;
      }
    });

    if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
      moduleCTIClient.enableWsFields();
    }

    moduleCTIClient.$wsToggleRadio.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');

        if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
          moduleCTIClient.enableWsFields();
        } else {
          moduleCTIClient.disableWsFields();
        }
      }
    });
    moduleCTIClient.initializeForm();
    moduleCTIClient.checkStatusToggle();
    window.addEventListener('ModuleStatusChanged', moduleCTIClient.checkStatusToggle);
  },

  /**
   * Проверка состояния модуля
   */
  checkStatusToggle: function checkStatusToggle() {
    if (moduleCTIClient.$statusToggle.checkbox('is checked')) {
      $('.disability').removeClass('disabled');
      moduleCTIClient.$moduleStatus.show();
      moduleCTIClientConnectionCheckWorker.errorCounts = 0;
      moduleCTIClientConnectionCheckWorker.initialize();
    } else {
      moduleCTIClient.$moduleStatus.hide();
      moduleCTIClient.$moduleStatus.hide();
      $('.disability').addClass('disabled');
      $('.message.ajax').remove();
    }
  },

  /**
   * Включение режима работы через WS
   */
  enableWsFields: function enableWsFields() {
    moduleCTIClient.$wsOnlyFields.removeClass('disabled');
  },

  /**
   * Выключение режима работы через WS
   */
  disableWsFields: function disableWsFields() {
    moduleCTIClient.$wsOnlyFields.addClass('disabled');
  },

  /**
   * Применение настроек модуля после изменения данных формы
   */
  applyConfigurationChanges: function applyConfigurationChanges() {
    $.api({
      url: "".concat(Config.pbxUrl, "/pbxcore/api/modules/ModuleCTIClient/reload"),
      on: 'now',
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return Object.keys(response).length > 0 && response.result === true;
      },
      onSuccess: function onSuccess() {
        moduleCTIClientConnectionCheckWorker.initialize();
        moduleCTIClient.initialize();
      }
    });
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = moduleCTIClient.$formObj.form('get values');
    return result;
  },
  cbAfterSendForm: function cbAfterSendForm() {
    moduleCTIClient.applyConfigurationChanges();
    moduleCTIClientConnectionCheckWorker.errorCounts = 0;
  },
  initializeForm: function initializeForm() {
    Form.$formObj = moduleCTIClient.$formObj;
    Form.url = "".concat(globalRootUrl, "module-c-t-i-client/save");
    Form.validateRules = moduleCTIClient.validateRules;
    Form.cbBeforeSendForm = moduleCTIClient.cbBeforeSendForm;
    Form.cbAfterSendForm = moduleCTIClient.cbAfterSendForm;
    Form.initialize();
  }
};

$.fn.form.settings.rules.emptyCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked') && value === '') {
    return false;
  }

  return true;
};

$.fn.form.settings.rules.wrongPortCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked')) {
    return $.fn.form.settings.rules.integer(value, '1..65535');
  }

  return true;
};

$(document).ready(function () {
  moduleCTIClient.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtY3RpLWNsaWVudC1pbmRleC5qcyJdLCJuYW1lcyI6WyJtb2R1bGVDVElDbGllbnQiLCIkd3NUb2dnbGUiLCIkIiwiJHdzVG9nZ2xlUmFkaW8iLCIkc3RhdHVzVG9nZ2xlIiwiJGZvcm1PYmoiLCIkbW9kdWxlU3RhdHVzIiwiJGRlYnVnVG9nZ2xlIiwiJGF1dG9TZXR0aW5nc1RvZ2dsZSIsIiRvbmx5QXV0b1NldHRpbmdzVmlzaWJsZSIsIiRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlIiwiJHdzT25seUZpZWxkcyIsIiRkaXJydHlGaWVsZCIsIiRkZWJ1Z1RhYiIsInZhbGlkYXRlUnVsZXMiLCJzZXJ2ZXIxY2hvc3QiLCJpZGVudGlmaWVyIiwicnVsZXMiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwibW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDSG9zdEVtcHR5Iiwic2VydmVyMWNwb3J0IiwibW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDUG9ydFJhbmdlIiwiZGF0YWJhc2UiLCJtb2RfY3RpX1ZhbGlkYXRlUHViTmFtZSIsImluaXRpYWxpemUiLCJ0YWIiLCJjaGVja2JveCIsImhpZGUiLCJvbkNoZWNrZWQiLCJzaG93Iiwib25VbmNoZWNrZWQiLCJ2YWwiLCJNYXRoIiwicmFuZG9tIiwidHJpZ2dlciIsIkZvcm0iLCJlbmFibGVXc0ZpZWxkcyIsImRpc2FibGVXc0ZpZWxkcyIsImluaXRpYWxpemVGb3JtIiwiY2hlY2tTdGF0dXNUb2dnbGUiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlQ2xhc3MiLCJtb2R1bGVDVElDbGllbnRDb25uZWN0aW9uQ2hlY2tXb3JrZXIiLCJlcnJvckNvdW50cyIsImFkZENsYXNzIiwicmVtb3ZlIiwiYXBwbHlDb25maWd1cmF0aW9uQ2hhbmdlcyIsImFwaSIsInVybCIsIkNvbmZpZyIsInBieFVybCIsIm9uIiwic3VjY2Vzc1Rlc3QiLCJyZXNwb25zZSIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJyZXN1bHQiLCJvblN1Y2Nlc3MiLCJjYkJlZm9yZVNlbmRGb3JtIiwic2V0dGluZ3MiLCJkYXRhIiwiZm9ybSIsImNiQWZ0ZXJTZW5kRm9ybSIsImdsb2JhbFJvb3RVcmwiLCJmbiIsImVtcHR5Q3VzdG9tUnVsZSIsInZhbHVlIiwid3JvbmdQb3J0Q3VzdG9tUnVsZSIsImludGVnZXIiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUEsSUFBTUEsZUFBZSxHQUFHO0FBQ3ZCQyxFQUFBQSxTQUFTLEVBQUVDLENBQUMsQ0FBQywwQkFBRCxDQURXO0FBRXZCQyxFQUFBQSxjQUFjLEVBQUVELENBQUMsQ0FBQyw0Q0FBRCxDQUZNO0FBR3ZCRSxFQUFBQSxhQUFhLEVBQUVGLENBQUMsQ0FBQyx1QkFBRCxDQUhPO0FBSXZCRyxFQUFBQSxRQUFRLEVBQUVILENBQUMsQ0FBQyx5QkFBRCxDQUpZO0FBS3ZCSSxFQUFBQSxhQUFhLEVBQUVKLENBQUMsQ0FBQyxTQUFELENBTE87QUFNdkJLLEVBQUFBLFlBQVksRUFBRUwsQ0FBQyxDQUFDLG9CQUFELENBTlE7QUFPdkJNLEVBQUFBLG1CQUFtQixFQUFFTixDQUFDLENBQUMsNEJBQUQsQ0FQQztBQVF2Qk8sRUFBQUEsd0JBQXdCLEVBQUVQLENBQUMsQ0FBQyw2Q0FBRCxDQVJKO0FBU3ZCUSxFQUFBQSwwQkFBMEIsRUFBRVIsQ0FBQyxDQUFDLCtDQUFELENBVE47QUFVdkJTLEVBQUFBLGFBQWEsRUFBRVQsQ0FBQyxDQUFDLFVBQUQsQ0FWTztBQVd2QlUsRUFBQUEsWUFBWSxFQUFFVixDQUFDLENBQUMsU0FBRCxDQVhRO0FBWXZCVyxFQUFBQSxTQUFTLEVBQUVYLENBQUMsQ0FBQyxpREFBRCxDQVpXO0FBYXZCWSxFQUFBQSxhQUFhLEVBQUU7QUFDZEMsSUFBQUEsWUFBWSxFQUFFO0FBQ2JDLE1BQUFBLFVBQVUsRUFBRSxjQURDO0FBRWJDLE1BQUFBLEtBQUss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S0FDQTVCLGVBQWUsQ0FBQ0MsU0FBaEIsQ0FBMEIyQixRQUExQixDQUFtQyxZQUFuQyxDQURKLEVBRUU7QUFDRCxXQUFPMUIsQ0FBQyxDQUFDa0UsRUFBRixDQUFLSCxJQUFMLENBQVVGLFFBQVYsQ0FBbUI5QyxLQUFuQixDQUF5QnVELE9BQXpCLENBQWlDRixLQUFqQyxFQUF3QyxVQUF4QyxDQUFQO0FBQ0E7O0FBQ0QsU0FBTyxJQUFQO0FBQ0EsQ0FQRDs7QUFTQXBFLENBQUMsQ0FBQ3VFLFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkIxRSxFQUFBQSxlQUFlLENBQUMwQixVQUFoQjtBQUNBLENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IChDKSBNSUtPIExMQyAtIEFsbCBSaWdodHMgUmVzZXJ2ZWRcbiAqIFVuYXV0aG9yaXplZCBjb3B5aW5nIG9mIHRoaXMgZmlsZSwgdmlhIGFueSBtZWRpdW0gaXMgc3RyaWN0bHkgcHJvaGliaXRlZFxuICogUHJvcHJpZXRhcnkgYW5kIGNvbmZpZGVudGlhbFxuICogV3JpdHRlbiBieSBOaWtvbGF5IEJla2V0b3YsIDExIDIwMThcbiAqXG4gKi9cblxuXG5cbmNvbnN0IG1vZHVsZUNUSUNsaWVudCA9IHtcblx0JHdzVG9nZ2xlOiAkKCcjd2ViLXNlcnZpY2UtbW9kZS10b2dnbGUnKSxcblx0JHdzVG9nZ2xlUmFkaW86ICQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtIC53ZWItc2VydmljZS1yYWRpbycpLFxuXHQkc3RhdHVzVG9nZ2xlOiAkKCcjbW9kdWxlLXN0YXR1cy10b2dnbGUnKSxcblx0JGZvcm1PYmo6ICQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtJyksXG5cdCRtb2R1bGVTdGF0dXM6ICQoJyNzdGF0dXMnKSxcblx0JGRlYnVnVG9nZ2xlOiAkKCcjZGVidWctbW9kZS10b2dnbGUnKSxcblx0JGF1dG9TZXR0aW5nc1RvZ2dsZTogJCgnI2F1dG8tc2V0dGluZ3MtbW9kZS10b2dnbGUnKSxcblx0JG9ubHlBdXRvU2V0dGluZ3NWaXNpYmxlOiAkKCcjbW9kdWxlLWN0aS1jbGllbnQtZm9ybSAub25seS1hdXRvLXNldHRpbmdzJyksXG5cdCRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlOiAkKCcjbW9kdWxlLWN0aS1jbGllbnQtZm9ybSAub25seS1tYW51YWwtc2V0dGluZ3MnKSxcblx0JHdzT25seUZpZWxkczogJCgnLndzLW9ubHknKSxcblx0JGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cdCRkZWJ1Z1RhYjogJCgnI21vZHVsZS1jdGktY2xpZW50LXRhYnMgLml0ZW1bZGF0YS10YWI9XCJkZWJ1Z1wiXScpLFxuXHR2YWxpZGF0ZVJ1bGVzOiB7XG5cdFx0c2VydmVyMWNob3N0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnc2VydmVyMWNob3N0Jyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHlDdXN0b21SdWxlJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5tb2RfY3RpX1ZhbGlkYXRlU2VydmVyMUNIb3N0RW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0c2VydmVyMWNwb3J0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnc2VydmVyMWNwb3J0Jyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnd3JvbmdQb3J0Q3VzdG9tUnVsZScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUubW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDUG9ydFJhbmdlLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdGRhdGFiYXNlOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnZGF0YWJhc2UnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eUN1c3RvbVJ1bGUnLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLm1vZF9jdGlfVmFsaWRhdGVQdWJOYW1lLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHR9LFxuXHRpbml0aWFsaXplKCkge1xuXHRcdCQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtIC5pdGVtJykudGFiKCk7XG5cdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kZGVidWdUb2dnbGUuY2hlY2tib3goJ2lzIHVuY2hlY2tlZCcpKXtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGVidWdUYWIuaGlkZSgpXG5cdFx0fVxuXHRcdG1vZHVsZUNUSUNsaWVudC4kZGVidWdUb2dnbGVcblx0XHRcdC5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hlY2tlZCgpIHtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRlYnVnVGFiLnNob3coKVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRvblVuY2hlY2tlZCgpIHtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRlYnVnVGFiLmhpZGUoKVxuXHRcdFx0XHR9LFxuXHRcdFx0fSk7XG5cblx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiRhdXRvU2V0dGluZ3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSl7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlNYW51YWxTZXR0aW5nc1Zpc2libGUuaGlkZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlBdXRvU2V0dGluZ3NWaXNpYmxlLmhpZGUoKTtcblx0XHR9XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LiRhdXRvU2V0dGluZ3NUb2dnbGVcblx0XHRcdC5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hlY2tlZCgpIHtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlBdXRvU2V0dGluZ3NWaXNpYmxlLnNob3coKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlNYW51YWxTZXR0aW5nc1Zpc2libGUuaGlkZSgpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0ge307XG5cdFx0XHRcdH0sXG5cdFx0XHRcdG9uVW5jaGVja2VkKCkge1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5QXV0b1NldHRpbmdzVmlzaWJsZS5oaWRlKCk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlLnNob3coKTtcblx0XHRcdFx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBtb2R1bGVDVElDbGllbnQudmFsaWRhdGVSdWxlcztcblx0XHRcdFx0fSxcblx0XHRcdH0pO1xuXG5cblx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiR3c1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKSB7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuZW5hYmxlV3NGaWVsZHMoKTtcblx0XHR9XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LiR3c1RvZ2dsZVJhZGlvXG5cdFx0XHQuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiR3c1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKSB7XG5cdFx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuZW5hYmxlV3NGaWVsZHMoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LmRpc2FibGVXc0ZpZWxkcygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSxcblx0XHRcdH0pO1xuXHRcdG1vZHVsZUNUSUNsaWVudC5pbml0aWFsaXplRm9ybSgpO1xuXHRcdG1vZHVsZUNUSUNsaWVudC5jaGVja1N0YXR1c1RvZ2dsZSgpO1xuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdNb2R1bGVTdGF0dXNDaGFuZ2VkJywgbW9kdWxlQ1RJQ2xpZW50LmNoZWNrU3RhdHVzVG9nZ2xlKTtcblx0fSxcblx0LyoqXG5cdCAqINCf0YDQvtCy0LXRgNC60LAg0YHQvtGB0YLQvtGP0L3QuNGPINC80L7QtNGD0LvRj1xuXHQgKi9cblx0Y2hlY2tTdGF0dXNUb2dnbGUoKSB7XG5cdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kc3RhdHVzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcblx0XHRcdCQoJy5kaXNhYmlsaXR5JykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJG1vZHVsZVN0YXR1cy5zaG93KCk7XG5cdFx0XHRtb2R1bGVDVElDbGllbnRDb25uZWN0aW9uQ2hlY2tXb3JrZXIuZXJyb3JDb3VudHMgPSAwO1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50Q29ubmVjdGlvbkNoZWNrV29ya2VyLmluaXRpYWxpemUoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRtb2R1bGVTdGF0dXMuaGlkZSgpO1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRtb2R1bGVTdGF0dXMuaGlkZSgpO1xuXHRcdFx0JCgnLmRpc2FiaWxpdHknKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdCQoJy5tZXNzYWdlLmFqYXgnKS5yZW1vdmUoKTtcblx0XHR9XG5cdH0sXG5cdC8qKlxuXHQgKiDQktC60LvRjtGH0LXQvdC40LUg0YDQtdC20LjQvNCwINGA0LDQsdC+0YLRiyDRh9C10YDQtdC3IFdTXG5cdCAqL1xuXHRlbmFibGVXc0ZpZWxkcygpIHtcblx0XHRtb2R1bGVDVElDbGllbnQuJHdzT25seUZpZWxkcy5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0fSxcblx0LyoqXG5cdCAqINCS0YvQutC70Y7Rh9C10L3QuNC1INGA0LXQttC40LzQsCDRgNCw0LHQvtGC0Ysg0YfQtdGA0LXQtyBXU1xuXHQgKi9cblx0ZGlzYWJsZVdzRmllbGRzKCkge1xuXHRcdG1vZHVsZUNUSUNsaWVudC4kd3NPbmx5RmllbGRzLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHR9LFxuXHQvKipcblx0ICog0J/RgNC40LzQtdC90LXQvdC40LUg0L3QsNGB0YLRgNC+0LXQuiDQvNC+0LTRg9C70Y8g0L/QvtGB0LvQtSDQuNC30LzQtdC90LXQvdC40Y8g0LTQsNC90L3Ri9GFINGE0L7RgNC80Ytcblx0ICovXG5cdGFwcGx5Q29uZmlndXJhdGlvbkNoYW5nZXMoKSB7XG5cdFx0JC5hcGkoe1xuXHRcdFx0dXJsOiBgJHtDb25maWcucGJ4VXJsfS9wYnhjb3JlL2FwaS9tb2R1bGVzL01vZHVsZUNUSUNsaWVudC9yZWxvYWRgLFxuXHRcdFx0b246ICdub3cnLFxuXHRcdFx0c3VjY2Vzc1Rlc3QocmVzcG9uc2UpIHtcblx0XHRcdFx0Ly8gdGVzdCB3aGV0aGVyIGEgSlNPTiByZXNwb25zZSBpcyB2YWxpZFxuXHRcdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMocmVzcG9uc2UpLmxlbmd0aCA+IDAgJiYgcmVzcG9uc2UucmVzdWx0ID09PSB0cnVlO1xuXHRcdFx0fSxcblx0XHRcdG9uU3VjY2VzcygpIHtcblx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50Q29ubmVjdGlvbkNoZWNrV29ya2VyLmluaXRpYWxpemUoKTtcblx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LmluaXRpYWxpemUoKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcblx0XHRyZXN1bHQuZGF0YSA9IG1vZHVsZUNUSUNsaWVudC4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblx0Y2JBZnRlclNlbmRGb3JtKCkge1xuXHRcdG1vZHVsZUNUSUNsaWVudC5hcHBseUNvbmZpZ3VyYXRpb25DaGFuZ2VzKCk7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50Q29ubmVjdGlvbkNoZWNrV29ya2VyLmVycm9yQ291bnRzID0gMDtcblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IG1vZHVsZUNUSUNsaWVudC4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLWMtdC1pLWNsaWVudC9zYXZlYDtcblx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBtb2R1bGVDVElDbGllbnQudmFsaWRhdGVSdWxlcztcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBtb2R1bGVDVElDbGllbnQuY2JCZWZvcmVTZW5kRm9ybTtcblx0XHRGb3JtLmNiQWZ0ZXJTZW5kRm9ybSA9IG1vZHVsZUNUSUNsaWVudC5jYkFmdGVyU2VuZEZvcm07XG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5lbXB0eUN1c3RvbVJ1bGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0aWYgKG1vZHVsZUNUSUNsaWVudC4kYXV0b1NldHRpbmdzVG9nZ2xlLmNoZWNrYm94KCdpcyB1bmNoZWNrZWQnKVxuXHRcdCYmIG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKVxuXHRcdCYmIHZhbHVlID09PSAnJykge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy53cm9uZ1BvcnRDdXN0b21SdWxlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdGlmIChtb2R1bGVDVElDbGllbnQuJGF1dG9TZXR0aW5nc1RvZ2dsZS5jaGVja2JveCgnaXMgdW5jaGVja2VkJylcblx0XHQmJiBtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJylcblx0KSB7XG5cdFx0cmV0dXJuICQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5pbnRlZ2VyKHZhbHVlLCAnMS4uNjU1MzUnKTtcblx0fVxuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0bW9kdWxlQ1RJQ2xpZW50LmluaXRpYWxpemUoKTtcbn0pO1xuXG4iXX0=