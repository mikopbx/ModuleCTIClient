"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 11 2018
 *
 */
var moduleCTIClient = {
  $wsToggle: $('#web-service-mode-toggle'),
  $wsToggleRadio: $('#module-cti-client-form .web-service-radio'),
  $statusToggle: $('#module-status-toggle'),
  $callerIdSetupToggle: $('#setup-caller-id-toggle'),
  $callerIdTransliterationToggleBlock: $('#transliterate-caller-id-toggle-block'),
  $formObj: $('#module-cti-client-form'),
  $moduleStatus: $('#status'),
  $debugToggle: $('#debug-mode-toggle'),
  $autoSettingsToggle: $('#auto-settings-mode-toggle'),
  $onlyAutoSettingsVisible: $('#module-cti-client-form .only-auto-settings'),
  $onlyManualSettingsVisible: $('#module-cti-client-form .only-manual-settings'),
  $wsOnlyFields: $('.ws-only'),
  $dirrtyField: $('#dirrty'),
  $sslModeSelect: $('.server1c_scheme select'),
  $debugTab: $('#module-cti-client-tabs .item[data-tab="debug"]'),
  validateRules: {
    server1chost: {
      identifier: 'server1chost',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CHostEmpty
      }]
    },
    server1cport: {
      identifier: 'server1cport',
      rules: [{
        type: 'wrongPortCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CPortRange
      }]
    },
    database: {
      identifier: 'database',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidatePubName
      }]
    }
  },
  initialize: function initialize() {
    $('#module-cti-client-form .item').tab();

    if (moduleCTIClient.$debugToggle.checkbox('is unchecked')) {
      moduleCTIClient.$debugTab.hide();
    }

    moduleCTIClient.$debugToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$debugTab.show();
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$debugTab.hide();
      }
    });
    moduleCTIClient.$callerIdSetupToggle.checkbox({
      onChange: moduleCTIClient.setCallerIdToggle
    });

    if (moduleCTIClient.$autoSettingsToggle.checkbox('is checked')) {
      moduleCTIClient.$onlyManualSettingsVisible.hide();
    } else {
      moduleCTIClient.$onlyAutoSettingsVisible.hide();
    }

    moduleCTIClient.$autoSettingsToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$onlyAutoSettingsVisible.show();
        moduleCTIClient.$onlyManualSettingsVisible.hide();
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        Form.validateRules = {};
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        moduleCTIClient.$onlyAutoSettingsVisible.hide();
        moduleCTIClient.$onlyManualSettingsVisible.show();
        Form.validateRules = moduleCTIClient.validateRules;
      }
    });

    if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
      moduleCTIClient.enableWsFields();
    }

    moduleCTIClient.$wsToggleRadio.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');

        if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
          moduleCTIClient.enableWsFields();
        } else {
          moduleCTIClient.disableWsFields();
        }
      }
    });
    moduleCTIClient.$sslModeSelect.dropdown();
    moduleCTIClient.initializeForm();
    moduleCTIClient.checkStatusToggle();
    moduleCTIClient.setCallerIdToggle();
    window.addEventListener('ModuleStatusChanged', moduleCTIClient.checkStatusToggle);
  },

  /**
   * Проверка состояния модуля
   */
  checkStatusToggle: function checkStatusToggle() {
    if (moduleCTIClient.$statusToggle.checkbox('is checked')) {
      $('.disability').removeClass('disabled');
      moduleCTIClient.$moduleStatus.show();
      moduleCTIClientConnectionCheckWorker.initialize();
    } else {
      moduleCTIClient.$moduleStatus.hide();
      moduleCTIClient.$moduleStatus.hide();
      $('.disability').addClass('disabled');
      $('.message.ajax').remove();
    }
  },

  /**
   * Переключатель установки CallerID из 1С
   * Прячет или показывает статус транслитерации
   */
  setCallerIdToggle: function setCallerIdToggle() {
    if (moduleCTIClient.$callerIdSetupToggle.checkbox('is checked')) {
      moduleCTIClient.$callerIdTransliterationToggleBlock.show();
    } else {
      moduleCTIClient.$callerIdTransliterationToggleBlock.hide();
    }
  },

  /**
   * Включение режима работы через WS
   */
  enableWsFields: function enableWsFields() {
    moduleCTIClient.$wsOnlyFields.removeClass('disabled');
  },

  /**
   * Выключение режима работы через WS
   */
  disableWsFields: function disableWsFields() {
    moduleCTIClient.$wsOnlyFields.addClass('disabled');
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = moduleCTIClient.$formObj.form('get values');
    return result;
  },
  cbAfterSendForm: function cbAfterSendForm() {
    moduleCTIClient.initialize();
  },
  initializeForm: function initializeForm() {
    Form.$formObj = moduleCTIClient.$formObj;
    Form.url = "".concat(globalRootUrl, "module-c-t-i-client/save");
    Form.validateRules = moduleCTIClient.validateRules;
    Form.cbBeforeSendForm = moduleCTIClient.cbBeforeSendForm;
    Form.cbAfterSendForm = moduleCTIClient.cbAfterSendForm;
    Form.initialize();
  }
};

$.fn.form.settings.rules.emptyCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked') && value === '') {
    return false;
  }

  return true;
};

$.fn.form.settings.rules.wrongPortCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked')) {
    return $.fn.form.settings.rules.integer(value, '1..65535');
  }

  return true;
};

$(document).ready(function () {
  moduleCTIClient.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtY3RpLWNsaWVudC1pbmRleC5qcyJdLCJuYW1lcyI6WyJtb2R1bGVDVElDbGllbnQiLCIkd3NUb2dnbGUiLCIkIiwiJHdzVG9nZ2xlUmFkaW8iLCIkc3RhdHVzVG9nZ2xlIiwiJGNhbGxlcklkU2V0dXBUb2dnbGUiLCIkY2FsbGVySWRUcmFuc2xpdGVyYXRpb25Ub2dnbGVCbG9jayIsIiRmb3JtT2JqIiwiJG1vZHVsZVN0YXR1cyIsIiRkZWJ1Z1RvZ2dsZSIsIiRhdXRvU2V0dGluZ3NUb2dnbGUiLCIkb25seUF1dG9TZXR0aW5nc1Zpc2libGUiLCIkb25seU1hbnVhbFNldHRpbmdzVmlzaWJsZSIsIiR3c09ubHlGaWVsZHMiLCIkZGlycnR5RmllbGQiLCIkc3NsTW9kZVNlbGVjdCIsIiRkZWJ1Z1RhYiIsInZhbGlkYXRlUnVsZXMiLCJzZXJ2ZXIxY2hvc3QiLCJpZGVudGlmaWVyIiwicnVsZXMiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwibW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDSG9zdEVtcHR5Iiwic2VydmVyMWNwb3J0IiwibW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDUG9ydFJhbmdlIiwiZGF0YWJhc2UiLCJtb2RfY3RpX1ZhbGlkYXRlUHViTmFtZSIsImluaXRpYWxpemUiLCJ0YWIiLCJjaGVja2JveCIsImhpZGUiLCJvbkNoZWNrZWQiLCJzaG93Iiwib25VbmNoZWNrZWQiLCJvbkNoYW5nZSIsInNldENhbGxlcklkVG9nZ2xlIiwidmFsIiwiTWF0aCIsInJhbmRvbSIsInRyaWdnZXIiLCJGb3JtIiwiZW5hYmxlV3NGaWVsZHMiLCJkaXNhYmxlV3NGaWVsZHMiLCJkcm9wZG93biIsImluaXRpYWxpemVGb3JtIiwiY2hlY2tTdGF0dXNUb2dnbGUiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlQ2xhc3MiLCJtb2R1bGVDVElDbGllbnRDb25uZWN0aW9uQ2hlY2tXb3JrZXIiLCJhZGRDbGFzcyIsInJlbW92ZSIsImNiQmVmb3JlU2VuZEZvcm0iLCJzZXR0aW5ncyIsInJlc3VsdCIsImRhdGEiLCJmb3JtIiwiY2JBZnRlclNlbmRGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImZuIiwiZW1wdHlDdXN0b21SdWxlIiwidmFsdWUiLCJ3cm9uZ1BvcnRDdXN0b21SdWxlIiwiaW50ZWdlciIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxJQUFNQSxlQUFlLEdBQUc7QUFDdkJDLEVBQUFBLFNBQVMsRUFBRUMsQ0FBQyxDQUFDLDBCQUFELENBRFc7QUFFdkJDLEVBQUFBLGNBQWMsRUFBRUQsQ0FBQyxDQUFDLDRDQUFELENBRk07QUFHdkJFLEVBQUFBLGFBQWEsRUFBRUYsQ0FBQyxDQUFDLHVCQUFELENBSE87QUFJdkJHLEVBQUFBLG9CQUFvQixFQUFFSCxDQUFDLENBQUMseUJBQUQsQ0FKQTtBQUt2QkksRUFBQUEsbUNBQW1DLEVBQUVKLENBQUMsQ0FBQyx1Q0FBRCxDQUxmO0FBTXZCSyxFQUFBQSxRQUFRLEVBQUVMLENBQUMsQ0FBQyx5QkFBRCxDQU5ZO0FBT3ZCTSxFQUFBQSxhQUFhLEVBQUVOLENBQUMsQ0FBQyxTQUFELENBUE87QUFRdkJPLEVBQUFBLFlBQVksRUFBRVAsQ0FBQyxDQUFDLG9CQUFELENBUlE7QUFTdkJRLEVBQUFBLG1CQUFtQixFQUFFUixDQUFDLENBQUMsNEJBQUQsQ0FUQztBQVV2QlMsRUFBQUEsd0JBQXdCLEVBQUVULENBQUMsQ0FBQyw2Q0FBRCxDQVZKO0FBV3ZCVSxFQUFBQSwwQkFBMEIsRUFBRVYsQ0FBQyxDQUFDLCtDQUFELENBWE47QUFZdkJXLEVBQUFBLGFBQWEsRUFBRVgsQ0FBQyxDQUFDLFVBQUQsQ0FaTztBQWF2QlksRUFBQUEsWUFBWSxFQUFFWixDQUFDLENBQUMsU0FBRCxDQWJRO0FBY3ZCYSxFQUFBQSxjQUFjLEVBQUViLENBQUMsQ0FBQyx5QkFBRCxDQWRNO0FBZXZCYyxF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LGVBQWUsQ0FBQ1UsbUJBQWhCLENBQW9DcUIsUUFBcEMsQ0FBNkMsY0FBN0MsS0FDQS9CLGVBQWUsQ0FBQ0MsU0FBaEIsQ0FBMEI4QixRQUExQixDQUFtQyxZQUFuQyxDQURKLEVBRUU7QUFDRCxXQUFPN0IsQ0FBQyxDQUFDNEQsRUFBRixDQUFLSixJQUFMLENBQVVILFFBQVYsQ0FBbUJuQyxLQUFuQixDQUF5QjhDLE9BQXpCLENBQWlDRixLQUFqQyxFQUF3QyxVQUF4QyxDQUFQO0FBQ0E7O0FBQ0QsU0FBTyxJQUFQO0FBQ0EsQ0FQRDs7QUFTQTlELENBQUMsQ0FBQ2lFLFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkJwRSxFQUFBQSxlQUFlLENBQUM2QixVQUFoQjtBQUNBLENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IChDKSBNSUtPIExMQyAtIEFsbCBSaWdodHMgUmVzZXJ2ZWRcbiAqIFVuYXV0aG9yaXplZCBjb3B5aW5nIG9mIHRoaXMgZmlsZSwgdmlhIGFueSBtZWRpdW0gaXMgc3RyaWN0bHkgcHJvaGliaXRlZFxuICogUHJvcHJpZXRhcnkgYW5kIGNvbmZpZGVudGlhbFxuICogV3JpdHRlbiBieSBOaWtvbGF5IEJla2V0b3YsIDExIDIwMThcbiAqXG4gKi9cblxuY29uc3QgbW9kdWxlQ1RJQ2xpZW50ID0ge1xuXHQkd3NUb2dnbGU6ICQoJyN3ZWItc2VydmljZS1tb2RlLXRvZ2dsZScpLFxuXHQkd3NUb2dnbGVSYWRpbzogJCgnI21vZHVsZS1jdGktY2xpZW50LWZvcm0gLndlYi1zZXJ2aWNlLXJhZGlvJyksXG5cdCRzdGF0dXNUb2dnbGU6ICQoJyNtb2R1bGUtc3RhdHVzLXRvZ2dsZScpLFxuXHQkY2FsbGVySWRTZXR1cFRvZ2dsZTogJCgnI3NldHVwLWNhbGxlci1pZC10b2dnbGUnKSxcblx0JGNhbGxlcklkVHJhbnNsaXRlcmF0aW9uVG9nZ2xlQmxvY2s6ICQoJyN0cmFuc2xpdGVyYXRlLWNhbGxlci1pZC10b2dnbGUtYmxvY2snKSxcblx0JGZvcm1PYmo6ICQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtJyksXG5cdCRtb2R1bGVTdGF0dXM6ICQoJyNzdGF0dXMnKSxcblx0JGRlYnVnVG9nZ2xlOiAkKCcjZGVidWctbW9kZS10b2dnbGUnKSxcblx0JGF1dG9TZXR0aW5nc1RvZ2dsZTogJCgnI2F1dG8tc2V0dGluZ3MtbW9kZS10b2dnbGUnKSxcblx0JG9ubHlBdXRvU2V0dGluZ3NWaXNpYmxlOiAkKCcjbW9kdWxlLWN0aS1jbGllbnQtZm9ybSAub25seS1hdXRvLXNldHRpbmdzJyksXG5cdCRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlOiAkKCcjbW9kdWxlLWN0aS1jbGllbnQtZm9ybSAub25seS1tYW51YWwtc2V0dGluZ3MnKSxcblx0JHdzT25seUZpZWxkczogJCgnLndzLW9ubHknKSxcblx0JGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cdCRzc2xNb2RlU2VsZWN0OiAkKCcuc2VydmVyMWNfc2NoZW1lIHNlbGVjdCcpLFxuXHQkZGVidWdUYWI6ICQoJyNtb2R1bGUtY3RpLWNsaWVudC10YWJzIC5pdGVtW2RhdGEtdGFiPVwiZGVidWdcIl0nKSxcblx0dmFsaWRhdGVSdWxlczoge1xuXHRcdHNlcnZlcjFjaG9zdDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ3NlcnZlcjFjaG9zdCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Q3VzdG9tUnVsZScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUubW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDSG9zdEVtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdHNlcnZlcjFjcG9ydDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ3NlcnZlcjFjcG9ydCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ3dyb25nUG9ydEN1c3RvbVJ1bGUnLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLm1vZF9jdGlfVmFsaWRhdGVTZXJ2ZXIxQ1BvcnRSYW5nZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRkYXRhYmFzZToge1xuXHRcdFx0aWRlbnRpZmllcjogJ2RhdGFiYXNlJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHlDdXN0b21SdWxlJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5tb2RfY3RpX1ZhbGlkYXRlUHViTmFtZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0fSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHQkKCcjbW9kdWxlLWN0aS1jbGllbnQtZm9ybSAuaXRlbScpLnRhYigpO1xuXHRcdGlmIChtb2R1bGVDVElDbGllbnQuJGRlYnVnVG9nZ2xlLmNoZWNrYm94KCdpcyB1bmNoZWNrZWQnKSl7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJGRlYnVnVGFiLmhpZGUoKVxuXHRcdH1cblx0XHRtb2R1bGVDVElDbGllbnQuJGRlYnVnVG9nZ2xlXG5cdFx0XHQuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkZWJ1Z1RhYi5zaG93KClcblx0XHRcdFx0fSxcblx0XHRcdFx0b25VbmNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkZWJ1Z1RhYi5oaWRlKClcblx0XHRcdFx0fSxcblx0XHRcdH0pO1xuXG5cblx0XHRtb2R1bGVDVElDbGllbnQuJGNhbGxlcklkU2V0dXBUb2dnbGVcblx0XHRcdC5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hhbmdlOiBtb2R1bGVDVElDbGllbnQuc2V0Q2FsbGVySWRUb2dnbGVcblx0XHRcdH0pO1xuXG5cblx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiRhdXRvU2V0dGluZ3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSl7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlNYW51YWxTZXR0aW5nc1Zpc2libGUuaGlkZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlBdXRvU2V0dGluZ3NWaXNpYmxlLmhpZGUoKTtcblx0XHR9XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LiRhdXRvU2V0dGluZ3NUb2dnbGVcblx0XHRcdC5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hlY2tlZCgpIHtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlBdXRvU2V0dGluZ3NWaXNpYmxlLnNob3coKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlNYW51YWxTZXR0aW5nc1Zpc2libGUuaGlkZSgpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0ge307XG5cdFx0XHRcdH0sXG5cdFx0XHRcdG9uVW5jaGVja2VkKCkge1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5QXV0b1NldHRpbmdzVmlzaWJsZS5oaWRlKCk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlLnNob3coKTtcblx0XHRcdFx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBtb2R1bGVDVElDbGllbnQudmFsaWRhdGVSdWxlcztcblx0XHRcdFx0fSxcblx0XHRcdH0pO1xuXG5cblx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiR3c1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKSB7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuZW5hYmxlV3NGaWVsZHMoKTtcblx0XHR9XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LiR3c1RvZ2dsZVJhZGlvXG5cdFx0XHQuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiR3c1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKSB7XG5cdFx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuZW5hYmxlV3NGaWVsZHMoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LmRpc2FibGVXc0ZpZWxkcygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSxcblx0XHRcdH0pO1xuXHRcdG1vZHVsZUNUSUNsaWVudC4kc3NsTW9kZVNlbGVjdC5kcm9wZG93bigpO1xuXHRcdG1vZHVsZUNUSUNsaWVudC5pbml0aWFsaXplRm9ybSgpO1xuXHRcdG1vZHVsZUNUSUNsaWVudC5jaGVja1N0YXR1c1RvZ2dsZSgpO1xuXHRcdG1vZHVsZUNUSUNsaWVudC5zZXRDYWxsZXJJZFRvZ2dsZSgpO1xuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdNb2R1bGVTdGF0dXNDaGFuZ2VkJywgbW9kdWxlQ1RJQ2xpZW50LmNoZWNrU3RhdHVzVG9nZ2xlKTtcblx0fSxcblx0LyoqXG5cdCAqINCf0YDQvtCy0LXRgNC60LAg0YHQvtGB0YLQvtGP0L3QuNGPINC80L7QtNGD0LvRj1xuXHQgKi9cblx0Y2hlY2tTdGF0dXNUb2dnbGUoKSB7XG5cdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kc3RhdHVzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcblx0XHRcdCQoJy5kaXNhYmlsaXR5JykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJG1vZHVsZVN0YXR1cy5zaG93KCk7XG5cdFx0XHRtb2R1bGVDVElDbGllbnRDb25uZWN0aW9uQ2hlY2tXb3JrZXIuaW5pdGlhbGl6ZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJG1vZHVsZVN0YXR1cy5oaWRlKCk7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJG1vZHVsZVN0YXR1cy5oaWRlKCk7XG5cdFx0XHQkKCcuZGlzYWJpbGl0eScpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0JCgnLm1lc3NhZ2UuYWpheCcpLnJlbW92ZSgpO1xuXHRcdH1cblx0fSxcblx0LyoqXG5cdCAqINCf0LXRgNC10LrQu9GO0YfQsNGC0LXQu9GMINGD0YHRgtCw0L3QvtCy0LrQuCBDYWxsZXJJRCDQuNC3IDHQoVxuXHQgKiDQn9GA0Y/Rh9C10YIg0LjQu9C4INC/0L7QutCw0LfRi9Cy0LDQtdGCINGB0YLQsNGC0YPRgSDRgtGA0LDQvdGB0LvQuNGC0LXRgNCw0YbQuNC4XG5cdCAqL1xuXHRzZXRDYWxsZXJJZFRvZ2dsZSgpIHtcblx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiRjYWxsZXJJZFNldHVwVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kY2FsbGVySWRUcmFuc2xpdGVyYXRpb25Ub2dnbGVCbG9jay5zaG93KCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kY2FsbGVySWRUcmFuc2xpdGVyYXRpb25Ub2dnbGVCbG9jay5oaWRlKCk7XG5cdFx0fVxuXHR9LFxuXHQvKipcblx0ICog0JLQutC70Y7Rh9C10L3QuNC1INGA0LXQttC40LzQsCDRgNCw0LHQvtGC0Ysg0YfQtdGA0LXQtyBXU1xuXHQgKi9cblx0ZW5hYmxlV3NGaWVsZHMoKSB7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LiR3c09ubHlGaWVsZHMucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdH0sXG5cdC8qKlxuXHQgKiDQktGL0LrQu9GO0YfQtdC90LjQtSDRgNC10LbQuNC80LAg0YDQsNCx0L7RgtGLINGH0LXRgNC10LcgV1Ncblx0ICovXG5cdGRpc2FibGVXc0ZpZWxkcygpIHtcblx0XHRtb2R1bGVDVElDbGllbnQuJHdzT25seUZpZWxkcy5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0fSxcblx0Y2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncykge1xuXHRcdGNvbnN0IHJlc3VsdCA9IHNldHRpbmdzO1xuXHRcdHJlc3VsdC5kYXRhID0gbW9kdWxlQ1RJQ2xpZW50LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHRjYkFmdGVyU2VuZEZvcm0oKSB7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LmluaXRpYWxpemUoKTtcblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IG1vZHVsZUNUSUNsaWVudC4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLWMtdC1pLWNsaWVudC9zYXZlYDtcblx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBtb2R1bGVDVElDbGllbnQudmFsaWRhdGVSdWxlcztcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBtb2R1bGVDVElDbGllbnQuY2JCZWZvcmVTZW5kRm9ybTtcblx0XHRGb3JtLmNiQWZ0ZXJTZW5kRm9ybSA9IG1vZHVsZUNUSUNsaWVudC5jYkFmdGVyU2VuZEZvcm07XG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5lbXB0eUN1c3RvbVJ1bGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0aWYgKG1vZHVsZUNUSUNsaWVudC4kYXV0b1NldHRpbmdzVG9nZ2xlLmNoZWNrYm94KCdpcyB1bmNoZWNrZWQnKVxuXHRcdCYmIG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKVxuXHRcdCYmIHZhbHVlID09PSAnJykge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy53cm9uZ1BvcnRDdXN0b21SdWxlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdGlmIChtb2R1bGVDVElDbGllbnQuJGF1dG9TZXR0aW5nc1RvZ2dsZS5jaGVja2JveCgnaXMgdW5jaGVja2VkJylcblx0XHQmJiBtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJylcblx0KSB7XG5cdFx0cmV0dXJuICQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5pbnRlZ2VyKHZhbHVlLCAnMS4uNjU1MzUnKTtcblx0fVxuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0bW9kdWxlQ1RJQ2xpZW50LmluaXRpYWxpemUoKTtcbn0pO1xuXG4iXX0=