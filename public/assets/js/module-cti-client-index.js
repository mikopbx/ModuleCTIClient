"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 11 2018
 *
 */
var moduleCTIClient = {
  $wsToggle: $('#web-service-mode-toggle'),
  $wsToggleRadio: $('#module-cti-client-form .web-service-radio'),
  $statusToggle: $('#module-status-toggle'),
  $formObj: $('#module-cti-client-form'),
  $moduleStatus: $('#status'),
  $debugToggle: $('#debug-mode-toggle'),
  $autoSettingsToggle: $('#auto-settings-mode-toggle'),
  $onlyAutoSettingsVisible: $('#module-cti-client-form .only-auto-settings'),
  $onlyManualSettingsVisible: $('#module-cti-client-form .only-manual-settings'),
  $wsOnlyFields: $('.ws-only'),
  $dirrtyField: $('#dirrty'),
  $debugTab: $('#module-cti-client-tabs .item[data-tab="debug"]'),
  validateRules: {
    server1chost: {
      identifier: 'server1chost',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CHostEmpty
      }]
    },
    server1cport: {
      identifier: 'server1cport',
      rules: [{
        type: 'wrongPortCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CPortRange
      }]
    },
    database: {
      identifier: 'database',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidatePubName
      }]
    }
  },
  initialize: function initialize() {
    $('#module-cti-client-form .item').tab();

    if (moduleCTIClient.$debugToggle.checkbox('is unchecked')) {
      moduleCTIClient.$debugTab.hide();
    }

    moduleCTIClient.$debugToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$debugTab.show();
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$debugTab.hide();
      }
    });

    if (moduleCTIClient.$autoSettingsToggle.checkbox('is checked')) {
      moduleCTIClient.$onlyManualSettingsVisible.hide();
    } else {
      moduleCTIClient.$onlyAutoSettingsVisible.hide();
    }

    moduleCTIClient.$autoSettingsToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$onlyAutoSettingsVisible.show();
        moduleCTIClient.$onlyManualSettingsVisible.hide();
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        Form.validateRules = {};
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        moduleCTIClient.$onlyAutoSettingsVisible.hide();
        moduleCTIClient.$onlyManualSettingsVisible.show();
        Form.validateRules = moduleCTIClient.validateRules;
      }
    });

    if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
      moduleCTIClient.enableWsFields();
    }

    moduleCTIClient.$wsToggleRadio.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');

        if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
          moduleCTIClient.enableWsFields();
        } else {
          moduleCTIClient.disableWsFields();
        }
      }
    });
    moduleCTIClient.initializeForm();
    moduleCTIClient.checkStatusToggle();
    window.addEventListener('ModuleStatusChanged', moduleCTIClient.checkStatusToggle);
  },

  /**
   * Проверка состояния модуля
   */
  checkStatusToggle: function checkStatusToggle() {
    if (moduleCTIClient.$statusToggle.checkbox('is checked')) {
      $('.disability').removeClass('disabled');
      moduleCTIClient.$moduleStatus.show();
      moduleCTIClientConnectionCheckWorker.initialize();
    } else {
      moduleCTIClient.$moduleStatus.hide();
      moduleCTIClient.$moduleStatus.hide();
      $('.disability').addClass('disabled');
      $('.message.ajax').remove();
    }
  },

  /**
   * Включение режима работы через WS
   */
  enableWsFields: function enableWsFields() {
    moduleCTIClient.$wsOnlyFields.removeClass('disabled');
  },

  /**
   * Выключение режима работы через WS
   */
  disableWsFields: function disableWsFields() {
    moduleCTIClient.$wsOnlyFields.addClass('disabled');
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = moduleCTIClient.$formObj.form('get values');
    return result;
  },
  cbAfterSendForm: function cbAfterSendForm() {
    moduleCTIClientConnectionCheckWorker.initialize();
    moduleCTIClient.initialize();
  },
  initializeForm: function initializeForm() {
    Form.$formObj = moduleCTIClient.$formObj;
    Form.url = "".concat(globalRootUrl, "module-c-t-i-client/save");
    Form.validateRules = moduleCTIClient.validateRules;
    Form.cbBeforeSendForm = moduleCTIClient.cbBeforeSendForm;
    Form.cbAfterSendForm = moduleCTIClient.cbAfterSendForm;
    Form.initialize();
  }
};

$.fn.form.settings.rules.emptyCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked') && value === '') {
    return false;
  }

  return true;
};

$.fn.form.settings.rules.wrongPortCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked')) {
    return $.fn.form.settings.rules.integer(value, '1..65535');
  }

  return true;
};

$(document).ready(function () {
  moduleCTIClient.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtY3RpLWNsaWVudC1pbmRleC5qcyJdLCJuYW1lcyI6WyJtb2R1bGVDVElDbGllbnQiLCIkd3NUb2dnbGUiLCIkIiwiJHdzVG9nZ2xlUmFkaW8iLCIkc3RhdHVzVG9nZ2xlIiwiJGZvcm1PYmoiLCIkbW9kdWxlU3RhdHVzIiwiJGRlYnVnVG9nZ2xlIiwiJGF1dG9TZXR0aW5nc1RvZ2dsZSIsIiRvbmx5QXV0b1NldHRpbmdzVmlzaWJsZSIsIiRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlIiwiJHdzT25seUZpZWxkcyIsIiRkaXJydHlGaWVsZCIsIiRkZWJ1Z1RhYiIsInZhbGlkYXRlUnVsZXMiLCJzZXJ2ZXIxY2hvc3QiLCJpZGVudGlmaWVyIiwicnVsZXMiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwibW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDSG9zdEVtcHR5Iiwic2VydmVyMWNwb3J0IiwibW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDUG9ydFJhbmdlIiwiZGF0YWJhc2UiLCJtb2RfY3RpX1ZhbGlkYXRlUHViTmFtZSIsImluaXRpYWxpemUiLCJ0YWIiLCJjaGVja2JveCIsImhpZGUiLCJvbkNoZWNrZWQiLCJzaG93Iiwib25VbmNoZWNrZWQiLCJ2YWwiLCJNYXRoIiwicmFuZG9tIiwidHJpZ2dlciIsIkZvcm0iLCJlbmFibGVXc0ZpZWxkcyIsImRpc2FibGVXc0ZpZWxkcyIsImluaXRpYWxpemVGb3JtIiwiY2hlY2tTdGF0dXNUb2dnbGUiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlQ2xhc3MiLCJtb2R1bGVDVElDbGllbnRDb25uZWN0aW9uQ2hlY2tXb3JrZXIiLCJhZGRDbGFzcyIsInJlbW92ZSIsImNiQmVmb3JlU2VuZEZvcm0iLCJzZXR0aW5ncyIsInJlc3VsdCIsImRhdGEiLCJmb3JtIiwiY2JBZnRlclNlbmRGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImZuIiwiZW1wdHlDdXN0b21S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LGNBQTdDLEtBQ0E1QixlQUFlLENBQUNDLFNBQWhCLENBQTBCMkIsUUFBMUIsQ0FBbUMsWUFBbkMsQ0FEQSxJQUVBOEIsS0FBSyxLQUFLLEVBRmQsRUFFa0I7QUFDakIsV0FBTyxLQUFQO0FBQ0E7O0FBQ0QsU0FBTyxJQUFQO0FBQ0EsQ0FQRDs7QUFTQXhELENBQUMsQ0FBQ3NELEVBQUYsQ0FBS0osSUFBTCxDQUFVSCxRQUFWLENBQW1CaEMsS0FBbkIsQ0FBeUIwQyxtQkFBekIsR0FBK0MsVUFBVUQsS0FBVixFQUFpQjtBQUMvRCxNQUFJMUQsZUFBZSxDQUFDUSxtQkFBaEIsQ0FBb0NvQixRQUFwQyxDQUE2QyxjQUE3QyxLQUNBNUIsZUFBZSxDQUFDQyxTQUFoQixDQUEwQjJCLFFBQTFCLENBQW1DLFlBQW5DLENBREosRUFFRTtBQUNELFdBQU8xQixDQUFDLENBQUNzRCxFQUFGLENBQUtKLElBQUwsQ0FBVUgsUUFBVixDQUFtQmhDLEtBQW5CLENBQXlCMkMsT0FBekIsQ0FBaUNGLEtBQWpDLEVBQXdDLFVBQXhDLENBQVA7QUFDQTs7QUFDRCxTQUFPLElBQVA7QUFDQSxDQVBEOztBQVNBeEQsQ0FBQyxDQUFDMkQsUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUN2QjlELEVBQUFBLGVBQWUsQ0FBQzBCLFVBQWhCO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKEMpIE1JS08gTExDIC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxuICogVW5hdXRob3JpemVkIGNvcHlpbmcgb2YgdGhpcyBmaWxlLCB2aWEgYW55IG1lZGl1bSBpcyBzdHJpY3RseSBwcm9oaWJpdGVkXG4gKiBQcm9wcmlldGFyeSBhbmQgY29uZmlkZW50aWFsXG4gKiBXcml0dGVuIGJ5IE5pa29sYXkgQmVrZXRvdiwgMTEgMjAxOFxuICpcbiAqL1xuXG5jb25zdCBtb2R1bGVDVElDbGllbnQgPSB7XG5cdCR3c1RvZ2dsZTogJCgnI3dlYi1zZXJ2aWNlLW1vZGUtdG9nZ2xlJyksXG5cdCR3c1RvZ2dsZVJhZGlvOiAkKCcjbW9kdWxlLWN0aS1jbGllbnQtZm9ybSAud2ViLXNlcnZpY2UtcmFkaW8nKSxcblx0JHN0YXR1c1RvZ2dsZTogJCgnI21vZHVsZS1zdGF0dXMtdG9nZ2xlJyksXG5cdCRmb3JtT2JqOiAkKCcjbW9kdWxlLWN0aS1jbGllbnQtZm9ybScpLFxuXHQkbW9kdWxlU3RhdHVzOiAkKCcjc3RhdHVzJyksXG5cdCRkZWJ1Z1RvZ2dsZTogJCgnI2RlYnVnLW1vZGUtdG9nZ2xlJyksXG5cdCRhdXRvU2V0dGluZ3NUb2dnbGU6ICQoJyNhdXRvLXNldHRpbmdzLW1vZGUtdG9nZ2xlJyksXG5cdCRvbmx5QXV0b1NldHRpbmdzVmlzaWJsZTogJCgnI21vZHVsZS1jdGktY2xpZW50LWZvcm0gLm9ubHktYXV0by1zZXR0aW5ncycpLFxuXHQkb25seU1hbnVhbFNldHRpbmdzVmlzaWJsZTogJCgnI21vZHVsZS1jdGktY2xpZW50LWZvcm0gLm9ubHktbWFudWFsLXNldHRpbmdzJyksXG5cdCR3c09ubHlGaWVsZHM6ICQoJy53cy1vbmx5JyksXG5cdCRkaXJydHlGaWVsZDogJCgnI2RpcnJ0eScpLFxuXHQkZGVidWdUYWI6ICQoJyNtb2R1bGUtY3RpLWNsaWVudC10YWJzIC5pdGVtW2RhdGEtdGFiPVwiZGVidWdcIl0nKSxcblx0dmFsaWRhdGVSdWxlczoge1xuXHRcdHNlcnZlcjFjaG9zdDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ3NlcnZlcjFjaG9zdCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Q3VzdG9tUnVsZScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUubW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDSG9zdEVtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdHNlcnZlcjFjcG9ydDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ3NlcnZlcjFjcG9ydCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ3dyb25nUG9ydEN1c3RvbVJ1bGUnLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLm1vZF9jdGlfVmFsaWRhdGVTZXJ2ZXIxQ1BvcnRSYW5nZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRkYXRhYmFzZToge1xuXHRcdFx0aWRlbnRpZmllcjogJ2RhdGFiYXNlJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHlDdXN0b21SdWxlJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5tb2RfY3RpX1ZhbGlkYXRlUHViTmFtZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0fSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHQkKCcjbW9kdWxlLWN0aS1jbGllbnQtZm9ybSAuaXRlbScpLnRhYigpO1xuXHRcdGlmIChtb2R1bGVDVElDbGllbnQuJGRlYnVnVG9nZ2xlLmNoZWNrYm94KCdpcyB1bmNoZWNrZWQnKSl7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJGRlYnVnVGFiLmhpZGUoKVxuXHRcdH1cblx0XHRtb2R1bGVDVElDbGllbnQuJGRlYnVnVG9nZ2xlXG5cdFx0XHQuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkZWJ1Z1RhYi5zaG93KClcblx0XHRcdFx0fSxcblx0XHRcdFx0b25VbmNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkZWJ1Z1RhYi5oaWRlKClcblx0XHRcdFx0fSxcblx0XHRcdH0pO1xuXG5cdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kYXV0b1NldHRpbmdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpe1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlLmhpZGUoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5QXV0b1NldHRpbmdzVmlzaWJsZS5oaWRlKCk7XG5cdFx0fVxuXHRcdG1vZHVsZUNUSUNsaWVudC4kYXV0b1NldHRpbmdzVG9nZ2xlXG5cdFx0XHQuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5QXV0b1NldHRpbmdzVmlzaWJsZS5zaG93KCk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlLmhpZGUoKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IHt9O1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRvblVuY2hlY2tlZCgpIHtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seUF1dG9TZXR0aW5nc1Zpc2libGUuaGlkZSgpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seU1hbnVhbFNldHRpbmdzVmlzaWJsZS5zaG93KCk7XG5cdFx0XHRcdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0gbW9kdWxlQ1RJQ2xpZW50LnZhbGlkYXRlUnVsZXM7XG5cdFx0XHRcdH0sXG5cdFx0XHR9KTtcblxuXG5cdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSkge1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LmVuYWJsZVdzRmllbGRzKCk7XG5cdFx0fVxuXHRcdG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGVSYWRpb1xuXHRcdFx0LmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGVja2VkKCkge1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdFx0aWYgKG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSkge1xuXHRcdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LmVuYWJsZVdzRmllbGRzKCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC5kaXNhYmxlV3NGaWVsZHMoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sXG5cdFx0XHR9KTtcblx0XHRtb2R1bGVDVElDbGllbnQuaW5pdGlhbGl6ZUZvcm0oKTtcblx0XHRtb2R1bGVDVElDbGllbnQuY2hlY2tTdGF0dXNUb2dnbGUoKTtcblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignTW9kdWxlU3RhdHVzQ2hhbmdlZCcsIG1vZHVsZUNUSUNsaWVudC5jaGVja1N0YXR1c1RvZ2dsZSk7XG5cdH0sXG5cdC8qKlxuXHQgKiDQn9GA0L7QstC10YDQutCwINGB0L7RgdGC0L7Rj9C90LjRjyDQvNC+0LTRg9C70Y9cblx0ICovXG5cdGNoZWNrU3RhdHVzVG9nZ2xlKCkge1xuXHRcdGlmIChtb2R1bGVDVElDbGllbnQuJHN0YXR1c1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKSB7XG5cdFx0XHQkKCcuZGlzYWJpbGl0eScpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRtb2R1bGVTdGF0dXMuc2hvdygpO1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50Q29ubmVjdGlvbkNoZWNrV29ya2VyLmluaXRpYWxpemUoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRtb2R1bGVTdGF0dXMuaGlkZSgpO1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRtb2R1bGVTdGF0dXMuaGlkZSgpO1xuXHRcdFx0JCgnLmRpc2FiaWxpdHknKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdCQoJy5tZXNzYWdlLmFqYXgnKS5yZW1vdmUoKTtcblx0XHR9XG5cdH0sXG5cdC8qKlxuXHQgKiDQktC60LvRjtGH0LXQvdC40LUg0YDQtdC20LjQvNCwINGA0LDQsdC+0YLRiyDRh9C10YDQtdC3IFdTXG5cdCAqL1xuXHRlbmFibGVXc0ZpZWxkcygpIHtcblx0XHRtb2R1bGVDVElDbGllbnQuJHdzT25seUZpZWxkcy5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0fSxcblx0LyoqXG5cdCAqINCS0YvQutC70Y7Rh9C10L3QuNC1INGA0LXQttC40LzQsCDRgNCw0LHQvtGC0Ysg0YfQtdGA0LXQtyBXU1xuXHQgKi9cblx0ZGlzYWJsZVdzRmllbGRzKCkge1xuXHRcdG1vZHVsZUNUSUNsaWVudC4kd3NPbmx5RmllbGRzLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHR9LFxuXHRjYkJlZm9yZVNlbmRGb3JtKHNldHRpbmdzKSB7XG5cdFx0Y29uc3QgcmVzdWx0ID0gc2V0dGluZ3M7XG5cdFx0cmVzdWx0LmRhdGEgPSBtb2R1bGVDVElDbGllbnQuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdGNiQWZ0ZXJTZW5kRm9ybSgpIHtcblx0XHRtb2R1bGVDVElDbGllbnRDb25uZWN0aW9uQ2hlY2tXb3JrZXIuaW5pdGlhbGl6ZSgpO1xuXHRcdG1vZHVsZUNUSUNsaWVudC5pbml0aWFsaXplKCk7XG5cdH0sXG5cdGluaXRpYWxpemVGb3JtKCkge1xuXHRcdEZvcm0uJGZvcm1PYmogPSBtb2R1bGVDVElDbGllbnQuJGZvcm1PYmo7XG5cdFx0Rm9ybS51cmwgPSBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS1jLXQtaS1jbGllbnQvc2F2ZWA7XG5cdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0gbW9kdWxlQ1RJQ2xpZW50LnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gbW9kdWxlQ1RJQ2xpZW50LmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBtb2R1bGVDVElDbGllbnQuY2JBZnRlclNlbmRGb3JtO1xuXHRcdEZvcm0uaW5pdGlhbGl6ZSgpO1xuXHR9LFxufTtcblxuXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuZW1wdHlDdXN0b21SdWxlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdGlmIChtb2R1bGVDVElDbGllbnQuJGF1dG9TZXR0aW5nc1RvZ2dsZS5jaGVja2JveCgnaXMgdW5jaGVja2VkJylcblx0XHQmJiBtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJylcblx0XHQmJiB2YWx1ZSA9PT0gJycpIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblx0cmV0dXJuIHRydWU7XG59O1xuXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMud3JvbmdQb3J0Q3VzdG9tUnVsZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRpZiAobW9kdWxlQ1RJQ2xpZW50LiRhdXRvU2V0dGluZ3NUb2dnbGUuY2hlY2tib3goJ2lzIHVuY2hlY2tlZCcpXG5cdFx0JiYgbW9kdWxlQ1RJQ2xpZW50LiR3c1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpXG5cdCkge1xuXHRcdHJldHVybiAkLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuaW50ZWdlcih2YWx1ZSwgJzEuLjY1NTM1Jyk7XG5cdH1cblx0cmV0dXJuIHRydWU7XG59O1xuXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG5cdG1vZHVsZUNUSUNsaWVudC5pbml0aWFsaXplKCk7XG59KTtcblxuIl19