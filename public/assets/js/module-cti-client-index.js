"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 11 2018
 *
 */
var moduleCTIClient = {
  $wsToggle: $('#web-service-mode-toggle'),
  $wsToggleRadio: $('#module-cti-client-form .web-service-radio'),
  $statusToggle: $('#module-status-toggle'),
  $formObj: $('#module-cti-client-form'),
  $moduleStatus: $('#status'),
  $debugToggle: $('#debug-mode-toggle'),
  $autoSettingsToggle: $('#auto-settings-mode-toggle'),
  $onlyAutoSettingsVisible: $('#module-cti-client-form .only-auto-settings'),
  $onlyManualSettingsVisible: $('#module-cti-client-form .only-manual-settings'),
  $wsOnlyFields: $('.ws-only'),
  $dirrtyField: $('#dirrty'),
  $debugTab: $('#module-cti-client-tabs .item[data-tab="debug"]'),
  validateRules: {
    server1chost: {
      identifier: 'server1chost',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CHostEmpty
      }]
    },
    server1cport: {
      identifier: 'server1cport',
      rules: [{
        type: 'wrongPortCustomRule',
        prompt: globalTranslate.mod_cti_ValidateServer1CPortRange
      }]
    },
    database: {
      identifier: 'database',
      rules: [{
        type: 'emptyCustomRule',
        prompt: globalTranslate.mod_cti_ValidatePubName
      }]
    }
  },
  initialize: function initialize() {
    $('#module-cti-client-form .item').tab();

    if (moduleCTIClient.$debugToggle.checkbox('is unchecked')) {
      moduleCTIClient.$debugTab.hide();
    }

    moduleCTIClient.$debugToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$debugTab.show();
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$debugTab.hide();
      }
    });

    if (moduleCTIClient.$autoSettingsToggle.checkbox('is checked')) {
      moduleCTIClient.$onlyManualSettingsVisible.hide();
    } else {
      moduleCTIClient.$onlyAutoSettingsVisible.hide();
    }

    moduleCTIClient.$autoSettingsToggle.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$onlyAutoSettingsVisible.show();
        moduleCTIClient.$onlyManualSettingsVisible.hide();
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        Form.validateRules = {};
      },
      onUnchecked: function onUnchecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');
        moduleCTIClient.$onlyAutoSettingsVisible.hide();
        moduleCTIClient.$onlyManualSettingsVisible.show();
        Form.validateRules = moduleCTIClient.validateRules;
      }
    });

    if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
      moduleCTIClient.enableWsFields();
    }

    moduleCTIClient.$wsToggleRadio.checkbox({
      onChecked: function onChecked() {
        moduleCTIClient.$dirrtyField.val(Math.random());
        moduleCTIClient.$dirrtyField.trigger('change');

        if (moduleCTIClient.$wsToggle.checkbox('is checked')) {
          moduleCTIClient.enableWsFields();
        } else {
          moduleCTIClient.disableWsFields();
        }
      }
    });
    moduleCTIClient.initializeForm();
    moduleCTIClient.checkStatusToggle();
    window.addEventListener('ModuleStatusChanged', moduleCTIClient.checkStatusToggle);
  },

  /**
   * Проверка состояния модуля
   */
  checkStatusToggle: function checkStatusToggle() {
    if (moduleCTIClient.$statusToggle.checkbox('is checked')) {
      $('.disability').removeClass('disabled');
      moduleCTIClient.$moduleStatus.show();
      moduleCTIClientConnectionCheckWorker.errorCounts = 0;
      moduleCTIClientConnectionCheckWorker.initialize();
    } else {
      moduleCTIClient.$moduleStatus.hide();
      moduleCTIClient.$moduleStatus.hide();
      $('.disability').addClass('disabled');
      $('.message.ajax').remove();
    }
  },

  /**
   * Включение режима работы через WS
   */
  enableWsFields: function enableWsFields() {
    moduleCTIClient.$wsOnlyFields.removeClass('disabled');
  },

  /**
   * Выключение режима работы через WS
   */
  disableWsFields: function disableWsFields() {
    moduleCTIClient.$wsOnlyFields.addClass('disabled');
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = moduleCTIClient.$formObj.form('get values');
    return result;
  },
  cbAfterSendForm: function cbAfterSendForm() {
    moduleCTIClientConnectionCheckWorker.initialize();
    moduleCTIClient.initialize();
  },
  initializeForm: function initializeForm() {
    Form.$formObj = moduleCTIClient.$formObj;
    Form.url = "".concat(globalRootUrl, "module-c-t-i-client/save");
    Form.validateRules = moduleCTIClient.validateRules;
    Form.cbBeforeSendForm = moduleCTIClient.cbBeforeSendForm;
    Form.cbAfterSendForm = moduleCTIClient.cbAfterSendForm;
    Form.initialize();
  }
};

$.fn.form.settings.rules.emptyCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked') && value === '') {
    return false;
  }

  return true;
};

$.fn.form.settings.rules.wrongPortCustomRule = function (value) {
  if (moduleCTIClient.$autoSettingsToggle.checkbox('is unchecked') && moduleCTIClient.$wsToggle.checkbox('is checked')) {
    return $.fn.form.settings.rules.integer(value, '1..65535');
  }

  return true;
};

$(document).ready(function () {
  moduleCTIClient.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtY3RpLWNsaWVudC1pbmRleC5qcyJdLCJuYW1lcyI6WyJtb2R1bGVDVElDbGllbnQiLCIkd3NUb2dnbGUiLCIkIiwiJHdzVG9nZ2xlUmFkaW8iLCIkc3RhdHVzVG9nZ2xlIiwiJGZvcm1PYmoiLCIkbW9kdWxlU3RhdHVzIiwiJGRlYnVnVG9nZ2xlIiwiJGF1dG9TZXR0aW5nc1RvZ2dsZSIsIiRvbmx5QXV0b1NldHRpbmdzVmlzaWJsZSIsIiRvbmx5TWFudWFsU2V0dGluZ3NWaXNpYmxlIiwiJHdzT25seUZpZWxkcyIsIiRkaXJydHlGaWVsZCIsIiRkZWJ1Z1RhYiIsInZhbGlkYXRlUnVsZXMiLCJzZXJ2ZXIxY2hvc3QiLCJpZGVudGlmaWVyIiwicnVsZXMiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwibW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDSG9zdEVtcHR5Iiwic2VydmVyMWNwb3J0IiwibW9kX2N0aV9WYWxpZGF0ZVNlcnZlcjFDUG9ydFJhbmdlIiwiZGF0YWJhc2UiLCJtb2RfY3RpX1ZhbGlkYXRlUHViTmFtZSIsImluaXRpYWxpemUiLCJ0YWIiLCJjaGVja2JveCIsImhpZGUiLCJvbkNoZWNrZWQiLCJzaG93Iiwib25VbmNoZWNrZWQiLCJ2YWwiLCJNYXRoIiwicmFuZG9tIiwidHJpZ2dlciIsIkZvcm0iLCJlbmFibGVXc0ZpZWxkcyIsImRpc2FibGVXc0ZpZWxkcyIsImluaXRpYWxpemVGb3JtIiwiY2hlY2tTdGF0dXNUb2dnbGUiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlQ2xhc3MiLCJtb2R1bGVDVElDbGllbnRDb25uZWN0aW9uQ2hlY2tXb3JrZXIiLCJlcnJvckNvdW50cyIsImFkZENsYXNzIiwicmVtb3ZlIiwiY2JCZWZvcmVTZW5kRm9ybSIsInNldHRpbmdzIiwicmVzdWx0IiwiZGF0YSIsImZvcm0iLCJjYkFmdGVyU2VuZEZvcm0iLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwiZm4iLCJlbXB0eUN1c3RvbVJ1bGUiLCJ2YWx1ZSIsIndyb25nUG9ydEN1c3RvbVJ1bGUiLCJpbnRlZ2VyIiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBLElBQU1BLGVBQWUsR0FBRztBQUN2QkMsRUFBQUEsU0FBUyxFQUFFQyxDQUFDLENBQUMsMEJBQUQsQ0FEVztBQUV2QkMsRUFBQUEsY0FBYyxFQUFFRCxDQUFDLENBQUMsNENBQUQsQ0FGTTtBQUd2QkUsRUFBQUEsYUFBYSxFQUFFRixDQUFDLENBQUMsdUJBQUQsQ0FITztBQUl2QkcsRUFBQUEsUUFBUSxFQUFFSCxDQUFDLENBQUMseUJBQUQsQ0FKWTtBQUt2QkksRUFBQUEsYUFBYSxFQUFFSixDQUFDLENBQUMsU0FBRCxDQUxPO0FBTXZCSyxFQUFBQSxZQUFZLEVBQUVMLENBQUMsQ0FBQyxvQkFBRCxDQU5RO0FBT3ZCTSxFQUFBQSxtQkFBbUIsRUFBRU4sQ0FBQyxDQUFDLDRCQUFELENBUEM7QUFRdkJPLEVBQUFBLHdCQUF3QixFQUFFUCxDQUFDLENBQUMsNkNBQUQsQ0FSSjtBQVN2QlEsRUFBQUEsMEJBQTBCLEVBQUVSLENBQUMsQ0FBQywrQ0FBRCxDQVROO0FBVXZCUyxFQUFBQSxhQUFhLEVBQUVULENBQUMsQ0FBQyxVQUFELENBVk87QUFXdkJVLEVBQUFBLFlBQVksRUFBRVYsQ0FBQyxDQUFDLFNBQUQsQ0FYUTtBQVl2QlcsRUFBQUEsU0FBUyxFQUFFWCxDQUFDLENBQUMsaURBQUQsQ0FaVztBQWF2QlksRUFBQUEsYUFBYSxFQUFFO0FBQ2RDLElBQUFBLFlBQVksRUFBRTtBQUNiQyxNQUFBQSxVQUFVLEVBQUUsY0FEQztBQUViQyxNQUFBQSxLQUFLLEVBQUUsQ0FDTjtBQUNDQyxRQUFBQSxJQUFJLEVBQUUsaUJBRFA7QUFFQ0MsUUFBQUEsTUFBTSxFQUFFQyxlQUFlLENBQUNDO0FBRnpCLE9BRE07QUFGTSxLQURBO0FBVWRDLElBQUFBLFlBQVksRUFBRTtBQUNi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LEVBQWlCO0FBQzNELE1BQUkzRCxlQUFlLENBQUNRLG1CQUFoQixDQUFvQ29CLFFBQXBDLENBQTZDLGNBQTdDLEtBQ0E1QixlQUFlLENBQUNDLFNBQWhCLENBQTBCMkIsUUFBMUIsQ0FBbUMsWUFBbkMsQ0FEQSxJQUVBK0IsS0FBSyxLQUFLLEVBRmQsRUFFa0I7QUFDakIsV0FBTyxLQUFQO0FBQ0E7O0FBQ0QsU0FBTyxJQUFQO0FBQ0EsQ0FQRDs7QUFTQXpELENBQUMsQ0FBQ3VELEVBQUYsQ0FBS0osSUFBTCxDQUFVSCxRQUFWLENBQW1CakMsS0FBbkIsQ0FBeUIyQyxtQkFBekIsR0FBK0MsVUFBVUQsS0FBVixFQUFpQjtBQUMvRCxNQUFJM0QsZUFBZSxDQUFDUSxtQkFBaEIsQ0FBb0NvQixRQUFwQyxDQUE2QyxjQUE3QyxLQUNBNUIsZUFBZSxDQUFDQyxTQUFoQixDQUEwQjJCLFFBQTFCLENBQW1DLFlBQW5DLENBREosRUFFRTtBQUNELFdBQU8xQixDQUFDLENBQUN1RCxFQUFGLENBQUtKLElBQUwsQ0FBVUgsUUFBVixDQUFtQmpDLEtBQW5CLENBQXlCNEMsT0FBekIsQ0FBaUNGLEtBQWpDLEVBQXdDLFVBQXhDLENBQVA7QUFDQTs7QUFDRCxTQUFPLElBQVA7QUFDQSxDQVBEOztBQVNBekQsQ0FBQyxDQUFDNEQsUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUN2Qi9ELEVBQUFBLGVBQWUsQ0FBQzBCLFVBQWhCO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKEMpIE1JS08gTExDIC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxuICogVW5hdXRob3JpemVkIGNvcHlpbmcgb2YgdGhpcyBmaWxlLCB2aWEgYW55IG1lZGl1bSBpcyBzdHJpY3RseSBwcm9oaWJpdGVkXG4gKiBQcm9wcmlldGFyeSBhbmQgY29uZmlkZW50aWFsXG4gKiBXcml0dGVuIGJ5IE5pa29sYXkgQmVrZXRvdiwgMTEgMjAxOFxuICpcbiAqL1xuXG5cblxuY29uc3QgbW9kdWxlQ1RJQ2xpZW50ID0ge1xuXHQkd3NUb2dnbGU6ICQoJyN3ZWItc2VydmljZS1tb2RlLXRvZ2dsZScpLFxuXHQkd3NUb2dnbGVSYWRpbzogJCgnI21vZHVsZS1jdGktY2xpZW50LWZvcm0gLndlYi1zZXJ2aWNlLXJhZGlvJyksXG5cdCRzdGF0dXNUb2dnbGU6ICQoJyNtb2R1bGUtc3RhdHVzLXRvZ2dsZScpLFxuXHQkZm9ybU9iajogJCgnI21vZHVsZS1jdGktY2xpZW50LWZvcm0nKSxcblx0JG1vZHVsZVN0YXR1czogJCgnI3N0YXR1cycpLFxuXHQkZGVidWdUb2dnbGU6ICQoJyNkZWJ1Zy1tb2RlLXRvZ2dsZScpLFxuXHQkYXV0b1NldHRpbmdzVG9nZ2xlOiAkKCcjYXV0by1zZXR0aW5ncy1tb2RlLXRvZ2dsZScpLFxuXHQkb25seUF1dG9TZXR0aW5nc1Zpc2libGU6ICQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtIC5vbmx5LWF1dG8tc2V0dGluZ3MnKSxcblx0JG9ubHlNYW51YWxTZXR0aW5nc1Zpc2libGU6ICQoJyNtb2R1bGUtY3RpLWNsaWVudC1mb3JtIC5vbmx5LW1hbnVhbC1zZXR0aW5ncycpLFxuXHQkd3NPbmx5RmllbGRzOiAkKCcud3Mtb25seScpLFxuXHQkZGlycnR5RmllbGQ6ICQoJyNkaXJydHknKSxcblx0JGRlYnVnVGFiOiAkKCcjbW9kdWxlLWN0aS1jbGllbnQtdGFicyAuaXRlbVtkYXRhLXRhYj1cImRlYnVnXCJdJyksXG5cdHZhbGlkYXRlUnVsZXM6IHtcblx0XHRzZXJ2ZXIxY2hvc3Q6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdzZXJ2ZXIxY2hvc3QnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eUN1c3RvbVJ1bGUnLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLm1vZF9jdGlfVmFsaWRhdGVTZXJ2ZXIxQ0hvc3RFbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRzZXJ2ZXIxY3BvcnQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdzZXJ2ZXIxY3BvcnQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICd3cm9uZ1BvcnRDdXN0b21SdWxlJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5tb2RfY3RpX1ZhbGlkYXRlU2VydmVyMUNQb3J0UmFuZ2UsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0ZGF0YWJhc2U6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdkYXRhYmFzZScsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Q3VzdG9tUnVsZScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUubW9kX2N0aV9WYWxpZGF0ZVB1Yk5hbWUsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0JCgnI21vZHVsZS1jdGktY2xpZW50LWZvcm0gLml0ZW0nKS50YWIoKTtcblx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiRkZWJ1Z1RvZ2dsZS5jaGVja2JveCgnaXMgdW5jaGVja2VkJykpe1xuXHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkZWJ1Z1RhYi5oaWRlKClcblx0XHR9XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LiRkZWJ1Z1RvZ2dsZVxuXHRcdFx0LmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGVja2VkKCkge1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGVidWdUYWIuc2hvdygpXG5cdFx0XHRcdH0sXG5cdFx0XHRcdG9uVW5jaGVja2VkKCkge1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kZGVidWdUYWIuaGlkZSgpXG5cdFx0XHRcdH0sXG5cdFx0XHR9KTtcblxuXHRcdGlmIChtb2R1bGVDVElDbGllbnQuJGF1dG9TZXR0aW5nc1RvZ2dsZS5jaGVja2JveCgnaXMgY2hlY2tlZCcpKXtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seU1hbnVhbFNldHRpbmdzVmlzaWJsZS5oaWRlKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seUF1dG9TZXR0aW5nc1Zpc2libGUuaGlkZSgpO1xuXHRcdH1cblx0XHRtb2R1bGVDVElDbGllbnQuJGF1dG9TZXR0aW5nc1RvZ2dsZVxuXHRcdFx0LmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGVja2VkKCkge1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seUF1dG9TZXR0aW5nc1Zpc2libGUuc2hvdygpO1xuXHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC4kb25seU1hbnVhbFNldHRpbmdzVmlzaWJsZS5oaWRlKCk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSB7fTtcblx0XHRcdFx0fSxcblx0XHRcdFx0b25VbmNoZWNrZWQoKSB7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRcdFx0bW9kdWxlQ1RJQ2xpZW50LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlBdXRvU2V0dGluZ3NWaXNpYmxlLmhpZGUoKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJG9ubHlNYW51YWxTZXR0aW5nc1Zpc2libGUuc2hvdygpO1xuXHRcdFx0XHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IG1vZHVsZUNUSUNsaWVudC52YWxpZGF0ZVJ1bGVzO1xuXHRcdFx0XHR9LFxuXHRcdFx0fSk7XG5cblxuXHRcdGlmIChtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC5lbmFibGVXc0ZpZWxkcygpO1xuXHRcdH1cblx0XHRtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlUmFkaW9cblx0XHRcdC5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hlY2tlZCgpIHtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHRcdGlmIChtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHtcblx0XHRcdFx0XHRcdG1vZHVsZUNUSUNsaWVudC5lbmFibGVXc0ZpZWxkcygpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRtb2R1bGVDVElDbGllbnQuZGlzYWJsZVdzRmllbGRzKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXHRcdFx0fSk7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LmluaXRpYWxpemVGb3JtKCk7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LmNoZWNrU3RhdHVzVG9nZ2xlKCk7XG5cdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ01vZHVsZVN0YXR1c0NoYW5nZWQnLCBtb2R1bGVDVElDbGllbnQuY2hlY2tTdGF0dXNUb2dnbGUpO1xuXHR9LFxuXHQvKipcblx0ICog0J/RgNC+0LLQtdGA0LrQsCDRgdC+0YHRgtC+0Y/QvdC40Y8g0LzQvtC00YPQu9GPXG5cdCAqL1xuXHRjaGVja1N0YXR1c1RvZ2dsZSgpIHtcblx0XHRpZiAobW9kdWxlQ1RJQ2xpZW50LiRzdGF0dXNUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKSkge1xuXHRcdFx0JCgnLmRpc2FiaWxpdHknKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdG1vZHVsZUNUSUNsaWVudC4kbW9kdWxlU3RhdHVzLnNob3coKTtcblx0XHRcdG1vZHVsZUNUSUNsaWVudENvbm5lY3Rpb25DaGVja1dvcmtlci5lcnJvckNvdW50cyA9IDA7XG5cdFx0XHRtb2R1bGVDVElDbGllbnRDb25uZWN0aW9uQ2hlY2tXb3JrZXIuaW5pdGlhbGl6ZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJG1vZHVsZVN0YXR1cy5oaWRlKCk7XG5cdFx0XHRtb2R1bGVDVElDbGllbnQuJG1vZHVsZVN0YXR1cy5oaWRlKCk7XG5cdFx0XHQkKCcuZGlzYWJpbGl0eScpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0JCgnLm1lc3NhZ2UuYWpheCcpLnJlbW92ZSgpO1xuXHRcdH1cblx0fSxcblx0LyoqXG5cdCAqINCS0LrQu9GO0YfQtdC90LjQtSDRgNC10LbQuNC80LAg0YDQsNCx0L7RgtGLINGH0LXRgNC10LcgV1Ncblx0ICovXG5cdGVuYWJsZVdzRmllbGRzKCkge1xuXHRcdG1vZHVsZUNUSUNsaWVudC4kd3NPbmx5RmllbGRzLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHR9LFxuXHQvKipcblx0ICog0JLRi9C60LvRjtGH0LXQvdC40LUg0YDQtdC20LjQvNCwINGA0LDQsdC+0YLRiyDRh9C10YDQtdC3IFdTXG5cdCAqL1xuXHRkaXNhYmxlV3NGaWVsZHMoKSB7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LiR3c09ubHlGaWVsZHMuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcblx0XHRyZXN1bHQuZGF0YSA9IG1vZHVsZUNUSUNsaWVudC4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblx0Y2JBZnRlclNlbmRGb3JtKCkge1xuXHRcdG1vZHVsZUNUSUNsaWVudENvbm5lY3Rpb25DaGVja1dvcmtlci5pbml0aWFsaXplKCk7XG5cdFx0bW9kdWxlQ1RJQ2xpZW50LmluaXRpYWxpemUoKTtcblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IG1vZHVsZUNUSUNsaWVudC4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLWMtdC1pLWNsaWVudC9zYXZlYDtcblx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBtb2R1bGVDVElDbGllbnQudmFsaWRhdGVSdWxlcztcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBtb2R1bGVDVElDbGllbnQuY2JCZWZvcmVTZW5kRm9ybTtcblx0XHRGb3JtLmNiQWZ0ZXJTZW5kRm9ybSA9IG1vZHVsZUNUSUNsaWVudC5jYkFmdGVyU2VuZEZvcm07XG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5lbXB0eUN1c3RvbVJ1bGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0aWYgKG1vZHVsZUNUSUNsaWVudC4kYXV0b1NldHRpbmdzVG9nZ2xlLmNoZWNrYm94KCdpcyB1bmNoZWNrZWQnKVxuXHRcdCYmIG1vZHVsZUNUSUNsaWVudC4kd3NUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKVxuXHRcdCYmIHZhbHVlID09PSAnJykge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy53cm9uZ1BvcnRDdXN0b21SdWxlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdGlmIChtb2R1bGVDVElDbGllbnQuJGF1dG9TZXR0aW5nc1RvZ2dsZS5jaGVja2JveCgnaXMgdW5jaGVja2VkJylcblx0XHQmJiBtb2R1bGVDVElDbGllbnQuJHdzVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJylcblx0KSB7XG5cdFx0cmV0dXJuICQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5pbnRlZ2VyKHZhbHVlLCAnMS4uNjU1MzUnKTtcblx0fVxuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0bW9kdWxlQ1RJQ2xpZW50LmluaXRpYWxpemUoKTtcbn0pO1xuXG4iXX0=